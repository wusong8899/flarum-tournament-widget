(function(e,y,d,p,P,f,t,u,b,k,T,i){"use strict";class F extends b{constructor(){super(...arguments),this.loading=!0,this.platforms=[],this.newPlatformName=f(""),this.newPlatformIconUrl=f(""),this.newPlatformIconClass=f(""),this.submitting=!1}oninit(a){super.oninit(a),this.loadPlatforms()}view(){return this.loading?t(p,null):t("div",{className:"PlatformManagement"},t("div",{className:"PlatformManagement-header"},t("h3",null,e.translator.trans("wusong8899-tournament-widget.admin.platforms.title"))),t("div",{className:"PlatformManagement-addForm"},t("h4",null,e.translator.trans("wusong8899-tournament-widget.admin.platforms.add_button")),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.platforms.name_label")),t("input",{className:"FormControl",type:"text",value:this.newPlatformName(),onchange:a=>this.newPlatformName(a.target.value),placeholder:e.translator.trans("wusong8899-tournament-widget.admin.platforms.name_help")})),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.platforms.icon_url_label")),t("input",{className:"FormControl",type:"url",value:this.newPlatformIconUrl(),onchange:a=>this.newPlatformIconUrl(a.target.value),placeholder:e.translator.trans("wusong8899-tournament-widget.admin.platforms.icon_url_help")})),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.platforms.icon_class_label")),t("input",{className:"FormControl",type:"text",value:this.newPlatformIconClass(),onchange:a=>this.newPlatformIconClass(a.target.value),placeholder:e.translator.trans("wusong8899-tournament-widget.admin.platforms.icon_class_help")})),t(d,{className:"Button Button--primary",loading:this.submitting,onclick:()=>this.createPlatform()},e.translator.trans("wusong8899-tournament-widget.admin.platforms.add_button"))),t("div",{className:"PlatformManagement-list"},t("h4",null,"Existing Platforms"),this.platforms.length>0?t("div",{className:"PlatformList"},this.platforms.map(a=>t("div",{key:a.id,className:"PlatformList-item"},t("div",{className:"platform-info"},t("div",{className:"platform-icon"},this.renderPlatformIcon(a)),t("div",{className:"platform-details"},t("div",{className:"platform-name"},a.attributes.name),t("div",{className:"platform-meta"},a.attributes.iconUrl&&t("span",{className:"meta-item"},"URL Icon: ",a.attributes.iconUrl),a.attributes.iconClass&&t("span",{className:"meta-item"},"CSS Icon: ",a.attributes.iconClass)))),t("div",{className:"platform-controls"},t(k,{state:a.attributes.isActive,onchange:r=>this.updatePlatform(a.id,{isActive:r})},a.attributes.isActive?e.translator.trans("wusong8899-tournament-widget.admin.platforms.enable"):e.translator.trans("wusong8899-tournament-widget.admin.platforms.disable")),t(d,{className:"Button Button--danger Button--icon",icon:"fas fa-trash",onclick:()=>this.deletePlatform(a.id),title:"Delete Platform"}))))):t("div",{className:"PlatformList-empty"},e.translator.trans("wusong8899-tournament-widget.admin.platforms.empty"))))}async loadPlatforms(){try{const a=await e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/tournament/platforms"});this.platforms=a.data||[],this.loading=!1,t.redraw()}catch(a){console.error("Failed to load platforms:",a),this.loading=!1,t.redraw()}}async createPlatform(){if(!this.newPlatformName().trim()){e.alerts.show({type:"error"},"Platform name is required");return}this.submitting=!0,t.redraw();try{const a=await e.request({method:"POST",url:e.forum.attribute("apiUrl")+"/tournament/platforms",body:{data:{type:"platforms",attributes:{name:this.newPlatformName(),iconUrl:this.newPlatformIconUrl()||null,iconClass:this.newPlatformIconClass()||null,isActive:!0,displayOrder:this.platforms.length}}}});this.platforms.push(a.data),this.newPlatformName(""),this.newPlatformIconUrl(""),this.newPlatformIconClass(""),e.alerts.show({type:"success"},"Platform created successfully")}catch(a){console.error("Failed to create platform:",a),e.alerts.show({type:"error"},"Failed to create platform")}finally{this.submitting=!1,t.redraw()}}async updatePlatform(a,r){try{const s=await e.request({method:"PATCH",url:e.forum.attribute("apiUrl")+"/tournament/platforms/"+a,body:{data:{type:"platforms",attributes:r}}}),n=this.platforms.findIndex(o=>o.id===a);n!==-1&&(this.platforms[n]=s.data,t.redraw())}catch(s){console.error("Failed to update platform:",s),e.alerts.show({type:"error"},"Failed to update platform")}}async deletePlatform(a){if(confirm("Are you sure you want to delete this platform?"))try{await e.request({method:"DELETE",url:e.forum.attribute("apiUrl")+`/tournament/platforms/${a}`}),this.platforms=this.platforms.filter(r=>r.id!==a),e.alerts.show({type:"success"},"Platform deleted successfully"),t.redraw()}catch(r){console.error("Failed to delete platform:",r),e.alerts.show({type:"error"},"Failed to delete platform")}}renderPlatformIcon(a){const{iconUrl:r,iconClass:s}=a.attributes;return r?t("img",{src:r,alt:a.attributes.name,className:"platform-icon-img"}):s?t("i",{className:`platform-icon-css ${s}`}):t("i",{className:"platform-icon-css fas fa-gamepad"})}}class E extends b{constructor(){super(...arguments),this.loading=!0,this.saving=!1,this.rankTitles={},this.entries=[],this.nextId=1}oninit(a){super.oninit(a),this.loadRankTitles()}view(){return this.loading?m(p,null):m("div",{className:"RankTitleManagement"},m("div",{className:"RankTitleManagement-header"},m("h3",null,e.translator.trans("wusong8899-tournament-widget.admin.rank_titles.title")),m("div",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.rank_titles.help"))),m("div",{className:"RankTitleManagement-list"},m("div",{className:"RankTitleManagement-listHeader"},m("div",{className:"rank-column"},e.translator.trans("wusong8899-tournament-widget.admin.rank_titles.rank_label")),m("div",{className:"title-column"},e.translator.trans("wusong8899-tournament-widget.admin.rank_titles.title_label")),m("div",{className:"actions-column"},"Actions")),this.entries.map(a=>m("div",{key:a.id,className:"RankTitleManagement-entry"},m("div",{className:"rank-column"},m("input",{className:"FormControl",type:"text",value:a.rank,placeholder:"1, 2-5, default",onchange:r=>this.updateEntryRank(a.id,r.target.value)})),m("div",{className:"title-column"},m("input",{className:"FormControl",type:"text",value:a.title,placeholder:e.translator.trans("wusong8899-tournament-widget.admin.rank_titles.title_placeholder"),onchange:r=>this.updateEntryTitle(a.id,r.target.value)})),m("div",{className:"actions-column"},m(d,{className:"Button Button--icon",icon:"fas fa-times",onclick:()=>this.removeEntry(a.id),title:"Remove"}))))),m("div",{className:"RankTitleManagement-actions"},m(d,{className:"Button",icon:"fas fa-plus",onclick:()=>this.addEntry()},e.translator.trans("wusong8899-tournament-widget.admin.rank_titles.add_rank")),m(d,{className:"Button Button--primary",loading:this.saving,onclick:()=>this.saveRankTitles()},e.translator.trans("wusong8899-tournament-widget.admin.rank_titles.save_button"))),m("div",{className:"RankTitleManagement-preview"},m("h4",null,e.translator.trans("wusong8899-tournament-widget.admin.rank_titles.preview_title")),m("div",{className:"preview-content"},this.renderPreview())))}async loadRankTitles(){try{const a=await e.request({method:"GET",url:e.forum.attribute("apiUrl")+"/tournament/rank-titles"});this.rankTitles=a.data.attributes.rankTitles||{},this.entriesFromRankTitles(),this.loading=!1,m.redraw()}catch(a){console.error("Failed to load rank titles:",a),this.loading=!1,m.redraw()}}entriesFromRankTitles(){this.entries=[],this.nextId=1,Object.entries(this.rankTitles).forEach(([a,r])=>{this.entries.push({id:String(this.nextId++),rank:a,title:r})}),this.entries.length===0&&this.addEntry()}addEntry(){this.entries.push({id:String(this.nextId++),rank:"",title:""}),m.redraw()}removeEntry(a){this.entries=this.entries.filter(r=>r.id!==a),m.redraw()}updateEntryRank(a,r){const s=this.entries.find(n=>n.id===a);s&&(s.rank=r,m.redraw())}updateEntryTitle(a,r){const s=this.entries.find(n=>n.id===a);s&&(s.title=r,m.redraw())}async saveRankTitles(){this.saving=!0,m.redraw();const a={};this.entries.forEach(r=>{r.rank.trim()&&r.title.trim()&&(a[r.rank.trim()]=r.title.trim())});try{await e.request({method:"POST",url:e.forum.attribute("apiUrl")+"/tournament/rank-titles",body:{data:{type:"rank-titles",attributes:{rankTitles:a}}}}),this.rankTitles=a,e.alerts.show({type:"success"},e.translator.trans("core.admin.saved_message"))}catch(r){console.error("Failed to save rank titles:",r),e.alerts.show({type:"error"},"Failed to save rank titles")}finally{this.saving=!1,m.redraw()}}renderPreview(){const a=[1,2,3,5,15,25];return m("div",{className:"preview-list"},a.map(r=>{const s=this.getTitleForRank(r);return m("div",{key:r,className:"preview-item"},m("span",{className:"preview-rank"},"#",r),m("span",{className:"preview-title"},s))}))}getTitleForRank(a){const r={};if(this.entries.forEach(s=>{s.rank.trim()&&s.title.trim()&&(r[s.rank.trim()]=s.title.trim())}),r[String(a)])return r[String(a)];for(const[s,n]of Object.entries(r))if(s.includes("-")){const[o,l]=s.split("-").map(Number);if(a>=o&&a<=l)return n}return r.default||"参赛选手"}}class S extends b{constructor(){super(...arguments),this.participants=[],this.loading=!1,this.saving=!1,this.deleting=!1,this.approving=!1,this.activeTab="all",this.editingScores={}}oninit(a){super.oninit(a),this.loadParticipants()}view(){if(this.loading)return t(p,null);const a=this.getFilteredParticipants(),r=this.participants.filter(s=>!s.isApproved).length;return t("div",{className:"ParticipantManagement"},t("div",{className:"ParticipantManagement-header"},t("h3",null,e.translator.trans("wusong8899-tournament-widget.admin.participants.title")),t("p",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.participants.description"))),t("div",{className:"ParticipantManagement-tabs"},t("button",{className:this.activeTab==="all"?"Button Button--primary":"Button",onclick:()=>this.switchTab("all")},e.translator.trans("wusong8899-tournament-widget.admin.participants.tab_all")," (",this.participants.length,")"),t("button",{className:this.activeTab==="pending"?"Button Button--primary":"Button",onclick:()=>this.switchTab("pending")},e.translator.trans("wusong8899-tournament-widget.admin.participants.tab_pending")," (",r,")"),t("button",{className:this.activeTab==="approved"?"Button Button--primary":"Button",onclick:()=>this.switchTab("approved")},e.translator.trans("wusong8899-tournament-widget.admin.participants.tab_approved")," (",this.participants.length-r,")")),a.length===0?t("div",{className:"ParticipantManagement-empty"},t("p",null,e.translator.trans("wusong8899-tournament-widget.admin.participants.no_participants"))):t("div",{className:"ParticipantManagement-table"},t("table",{className:"Table"},t("thead",null,t("tr",null,t("th",null,e.translator.trans("wusong8899-tournament-widget.admin.participants.user")),t("th",null,e.translator.trans("wusong8899-tournament-widget.admin.participants.platform")),t("th",null,e.translator.trans("wusong8899-tournament-widget.admin.participants.status")),t("th",null,e.translator.trans("wusong8899-tournament-widget.admin.participants.initial_score")),t("th",null,e.translator.trans("wusong8899-tournament-widget.admin.participants.score")),t("th",null,e.translator.trans("wusong8899-tournament-widget.admin.participants.actions")))),t("tbody",null,a.map(s=>t("tr",{key:s.id},t("td",null,t("div",{className:"ParticipantManagement-user"},s.user.avatarUrl&&t("img",{src:s.user.avatarUrl,alt:s.user.displayName,className:"Avatar Avatar--size-small"}),t("span",{className:"username"},s.user.displayName||s.user.username))),t("td",null,t("div",{className:"ParticipantManagement-platform"},t("span",{className:"platform-name"},s.platform?.name||"Unknown"),s.platformUsername&&t("span",{className:"platform-username"},"(",s.platformUsername,")"))),t("td",null,t("div",{className:"ParticipantManagement-status"},s.isApproved?t("span",{className:"Badge Badge--success"},e.translator.trans("wusong8899-tournament-widget.admin.participants.status_approved")):t("span",{className:"Badge Badge--danger"},e.translator.trans("wusong8899-tournament-widget.admin.participants.status_pending")),s.approvedAt&&s.approvedBy&&t("div",{className:"ParticipantManagement-approvedInfo"},t("small",null,e.translator.trans("wusong8899-tournament-widget.admin.participants.approved_by",{username:s.approvedBy.displayName||s.approvedBy.username,date:new Date(s.approvedAt).toLocaleDateString()}))))),t("td",null,t("div",{className:"ParticipantManagement-initialScore","data-negative":s.initialScore<0?"true":"false","data-positive":s.initialScore>0?"true":"false"},t("strong",null,s.initialScore||0))),t("td",null,t("div",{style:"display: flex; align-items: center; gap: 8px;"},t("input",{type:"number",className:"FormControl",style:"width: 100px;",value:this.editingScores[s.id]??s.score,oninput:n=>{const o=n.target.value;if(o===""||o==="-")this.editingScores[s.id]=o;else{const l=parseInt(o);isNaN(l)||(this.editingScores[s.id]=l)}}}),t(d,{className:"Button Button--primary Button--size-small",loading:this.saving,disabled:this.saving||this.deleting||this.approving,onclick:()=>this.updateScore(s)},e.translator.trans("wusong8899-tournament-widget.admin.participants.update")))),t("td",null,t("div",{style:"display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;"},!s.isApproved&&t("[",null,t(d,{className:"Button Button--success Button--size-small",loading:this.approving,disabled:this.saving||this.deleting||this.approving,onclick:()=>this.approveParticipant(s)},e.translator.trans("wusong8899-tournament-widget.admin.participants.approve")),t(d,{className:"Button Button--warning Button--size-small",loading:this.approving,disabled:this.saving||this.deleting||this.approving,onclick:()=>this.rejectParticipant(s)},e.translator.trans("wusong8899-tournament-widget.admin.participants.reject"))),t(d,{className:"Button Button--danger Button--size-small",loading:this.deleting,disabled:this.saving||this.deleting||this.approving,onclick:()=>this.confirmDeleteParticipant(s)},e.translator.trans("wusong8899-tournament-widget.admin.participants.remove"))))))))),t("div",{className:"ParticipantManagement-actions"},t(d,{className:"Button",onclick:()=>this.loadParticipants(),loading:this.loading},e.translator.trans("wusong8899-tournament-widget.admin.participants.refresh"))))}async loadParticipants(){this.loading=!0,t.redraw();try{const a=await e.request({method:"GET",url:`${e.forum.attribute("apiUrl")}/tournament/participants`,params:{include:"user,platform,approvedBy"}}),r=(s,n)=>a.included?.find(o=>o.type===s&&o.id===n);this.participants=(a.data||[]).map(s=>{const n=s.attributes||{},o=s.relationships||{},l=o.user?.data,c=o.platform?.data,h=o.approvedBy?.data,g=l?r("users",l.id):void 0,N=c?r("platforms",c.id):void 0,v=h?r("users",h.id):void 0;return{id:parseInt(s.id,10),amount:n.score||0,score:n.score||0,initialScore:n.initialScore||0,platformUsername:n.platformUsername||"",isApproved:!!n.isApproved,approvedAt:n.approvedAt?new Date(n.approvedAt).toISOString():void 0,createdAt:n.createdAt?new Date(n.createdAt).toISOString():"",user:g?{id:parseInt(g.id,10),username:g.attributes.username||"Unknown",displayName:g.attributes.displayName||g.attributes.username||"Unknown",avatarUrl:g.attributes.avatarUrl||void 0,money:g.attributes.money??0}:{id:0,username:"Deleted User",displayName:"Deleted User",money:0},platform:N?{id:parseInt(N.id,10),name:N.attributes.name||"Unknown"}:void 0,approvedBy:v?{id:parseInt(v.id,10),username:v.attributes.username||"Unknown",displayName:v.attributes.displayName||v.attributes.username||"Unknown"}:void 0}})}catch(a){console.error("Failed to load participants:",a),e.alerts.show({type:"error"},e.translator.trans("wusong8899-tournament-widget.admin.participants.load_error"))}finally{this.loading=!1,t.redraw()}}confirmDeleteParticipant(a){const r=u(e.translator.trans("wusong8899-tournament-widget.admin.participants.confirm_remove",{username:a.user.displayName||a.user.username}));confirm(r)&&this.deleteParticipant(a)}async deleteParticipant(a){this.deleting=!0,t.redraw();try{const r=e.store.getById("participants",String(a.id));r?await r.delete():await e.request({method:"DELETE",url:`${e.forum.attribute("apiUrl")}/tournament/participants/${a.id}`}),this.participants=this.participants.filter(s=>s.id!==a.id),e.alerts.show({type:"success"},e.translator.trans("wusong8899-tournament-widget.admin.participants.remove_success"))}catch(r){console.error("Failed to delete participant:",r),e.alerts.show({type:"error"},e.translator.trans("wusong8899-tournament-widget.admin.participants.remove_error"))}finally{this.deleting=!1,t.redraw()}}async updateScore(a){const r=this.editingScores[a.id];if(r===""||r==="-")return;const s=typeof r=="number"?r:parseInt(r,10);if(!(isNaN(s)||s===a.score)){this.saving=!0,t.redraw();try{const n=e.store.getById("participants",String(a.id));n?await n.save({score:s}):await e.request({method:"PATCH",url:`${e.forum.attribute("apiUrl")}/tournament/participants/${a.id}`,body:{data:{type:"participants",attributes:{score:s}}}}),a.score=s,a.amount=s,e.alerts.show({type:"success"},e.translator.trans("wusong8899-tournament-widget.admin.participants.update_success"))}catch(n){console.error("Failed to update score:",n),e.alerts.show({type:"error"},e.translator.trans("wusong8899-tournament-widget.admin.participants.update_error")),this.editingScores[a.id]=a.score}finally{this.saving=!1,t.redraw()}}}getFilteredParticipants(){switch(this.activeTab){case"pending":return this.participants.filter(a=>!a.isApproved);case"approved":return this.participants.filter(a=>a.isApproved);case"all":default:return this.participants}}switchTab(a){this.activeTab=a,t.redraw()}async approveParticipant(a){this.approving=!0,t.redraw();try{await e.request({method:"PATCH",url:`${e.forum.attribute("apiUrl")}/tournament/participants/${a.id}/approve`,body:{data:{type:"participants",attributes:{action:"approve"}}}}),a.isApproved=!0,a.approvedAt=new Date().toISOString(),e.alerts.show({type:"success"},e.translator.trans("wusong8899-tournament-widget.admin.participants.approve_success"))}catch(r){console.error("Failed to approve participant:",r),e.alerts.show({type:"error"},e.translator.trans("wusong8899-tournament-widget.admin.participants.approve_error"))}finally{this.approving=!1,t.redraw()}}async rejectParticipant(a){const r=u(e.translator.trans("wusong8899-tournament-widget.admin.participants.confirm_reject",{username:a.user.displayName||a.user.username}));if(confirm(r)){this.approving=!0,t.redraw();try{await e.request({method:"PATCH",url:`${e.forum.attribute("apiUrl")}/tournament/participants/${a.id}/approve`,body:{data:{type:"participants",attributes:{action:"reject"}}}}),this.participants=this.participants.filter(s=>s.id!==a.id),e.alerts.show({type:"success"},e.translator.trans("wusong8899-tournament-widget.admin.participants.reject_success"))}catch(s){console.error("Failed to reject participant:",s),e.alerts.show({type:"error"},e.translator.trans("wusong8899-tournament-widget.admin.participants.reject_error"))}finally{this.approving=!1,t.redraw()}}}}const _={GRAY_DARK:"#333333",CONTROL_BG:"#f8f9fa",BORDER:"#ddd"};class U extends y{constructor(){super(...arguments),this.activeTab=f("general"),this.loading=!1,this.validationErrors={},this.calculatedPrizePool="0"}oninit(a){super.oninit(a),e.setTitle(u(e.translator.trans("wusong8899-tournament-widget.admin.title"))),this.loadPrizePoolData()}async loadPrizePoolData(){try{const r=(await e.request({method:"GET",url:`${e.forum.attribute("apiUrl")}/tournament`}))?.data?.attributes?.prizePool;typeof r=="string"?(this.calculatedPrizePool=r,t.redraw()):(this.calculatedPrizePool="0",t.redraw())}catch(a){console.error("Failed to load prize pool data:",a)}}content(){return this.loading?t(p,null):t("div",{className:"TournamentManagementPage"},t("div",{className:"container"},t("div",{className:"TournamentManagementPage-header"},t("h2",null,e.translator.trans("wusong8899-tournament-widget.admin.title")),t("p",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.description"))),t("nav",{className:"TournamentManagementPage-tabs"},this.renderTab("general","wusong8899-tournament-widget.admin.tabs.general"),this.renderTab("platforms","wusong8899-tournament-widget.admin.tabs.platforms"),this.renderTab("rank_titles","wusong8899-tournament-widget.admin.tabs.rank_titles"),this.renderTab("participants","wusong8899-tournament-widget.admin.tabs.participants")),t("div",{className:"TournamentManagementPage-content"},this.renderTabContent())))}renderTab(a,r){const s=this.activeTab()===a;return t(d,{className:`Button Button--text TournamentManagementPage-tab ${s?"active":""}`,onclick:()=>this.activeTab(a)},e.translator.trans(r))}renderTabContent(){switch(this.activeTab()){case"general":return this.renderGeneralSettings();case"platforms":return t(F,null);case"rank_titles":return t(E,null);case"participants":return t(S,null);default:return this.renderGeneralSettings()}}renderGeneralSettings(){return t("div",{className:"TournamentManagementPage-generalSettings"},t("div",{className:"Form"},t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.settings.title_label")),t("input",{className:"FormControl",type:"text",bidi:this.setting("wusong8899_tournament.title")}),t("div",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.settings.title_help"))),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.settings.prize_pool_label")),t("div",{className:"FormControl--static",style:`padding: 8px 12px; background: ${_.CONTROL_BG}; border: 1px solid ${_.BORDER}; border-radius: 4px;`},t("strong",{style:`font-size: 16px; color: ${_.GRAY_DARK};`},this.calculatedPrizePool)),t("div",{className:"helpText"},"自动计算：所有参赛者分数总和（包括负数）")),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.settings.start_date_label")),t("input",{className:`FormControl ${this.validationErrors.start_date?"FormControl--error":""}`,type:"datetime-local",value:this.formatDateForInput(this.setting("wusong8899_tournament.start_date")()),step:"1",onchange:a=>this.validateAndSetDate(a.target.value)}),this.validationErrors.start_date&&t("div",{className:"FormGroup-error"},this.validationErrors.start_date),t("div",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.settings.start_date_help"))),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.settings.details_url_label")),t("input",{className:`FormControl ${this.validationErrors.details_url?"FormControl--error":""}`,type:"url",bidi:this.setting("wusong8899_tournament.details_url"),onchange:a=>this.validateUrl("details_url",a.target.value)}),this.validationErrors.details_url&&t("div",{className:"FormGroup-error"},this.validationErrors.details_url),t("div",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.settings.details_url_help"))),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.settings.background_image_label")),t("input",{className:`FormControl ${this.validationErrors.background_image?"FormControl--error":""}`,type:"url",bidi:this.setting("wusong8899_tournament.background_image"),onchange:a=>this.validateUrl("background_image",a.target.value)}),this.validationErrors.background_image&&t("div",{className:"FormGroup-error"},this.validationErrors.background_image),t("div",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.settings.background_image_help"))),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.settings.header_title_label")),t("input",{className:"FormControl",type:"text",bidi:this.setting("wusong8899_tournament.header_title")}),t("div",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.settings.header_title_help"))),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.settings.header_image_label")),t("input",{className:`FormControl ${this.validationErrors.header_image?"FormControl--error":""}`,type:"url",bidi:this.setting("wusong8899_tournament.header_image"),onchange:a=>this.validateUrl("header_image",a.target.value)}),this.validationErrors.header_image&&t("div",{className:"FormGroup-error"},this.validationErrors.header_image),t("div",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.settings.header_image_help"))),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.settings.preview_limit_label")),t("input",{className:`FormControl ${this.validationErrors.preview_limit?"FormControl--error":""}`,type:"number",min:"1",max:"50",bidi:this.setting("wusong8899_tournament.preview_limit"),onchange:a=>this.validatePreviewLimit(a.target.value)}),this.validationErrors.preview_limit&&t("div",{className:"FormGroup-error"},this.validationErrors.preview_limit),t("div",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.settings.preview_limit_help"))),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},e.translator.trans("wusong8899-tournament-widget.admin.settings.sort_order_label")),t(P,{value:this.setting("wusong8899_tournament.sort_order")()||"desc",onchange:this.setting("wusong8899_tournament.sort_order"),options:{desc:e.translator.trans("wusong8899-tournament-widget.admin.settings.sort_order_desc"),asc:e.translator.trans("wusong8899-tournament-widget.admin.settings.sort_order_asc")}}),t("div",{className:"helpText"},e.translator.trans("wusong8899-tournament-widget.admin.settings.sort_order_help"))),this.submitButton()))}validateUrl(a,r){if(!r.trim()){delete this.validationErrors[a],this.setting(`wusong8899_tournament.${a}`)(r);return}try{new URL(r),delete this.validationErrors[a],this.setting(`wusong8899_tournament.${a}`)(r)}catch{this.validationErrors[a]=u(e.translator.trans("wusong8899-tournament-widget.admin.validation.invalid_url"))}t.redraw()}validateAndSetDate(a){if(!a.trim()){delete this.validationErrors.start_date,this.setting("wusong8899_tournament.start_date")(a);return}try{const r=new Date(a);if(isNaN(r.getTime()))throw new Error("Invalid date");const s=r.toISOString();delete this.validationErrors.start_date,this.setting("wusong8899_tournament.start_date")(s)}catch{this.validationErrors.start_date=u(e.translator.trans("wusong8899-tournament-widget.admin.validation.invalid_date"))}t.redraw()}validatePreviewLimit(a){if(!a.trim()){delete this.validationErrors.preview_limit,this.setting("wusong8899_tournament.preview_limit")("5");return}const r=parseInt(a);isNaN(r)||r<1||r>50?this.validationErrors.preview_limit=u(e.translator.trans("wusong8899-tournament-widget.admin.validation.invalid_preview_limit")):(delete this.validationErrors.preview_limit,this.setting("wusong8899_tournament.preview_limit")(a)),t.redraw()}formatDateForInput(a){if(!a)return"";try{const r=new Date(a);if(isNaN(r.getTime()))return"";const s=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0"),l=String(r.getHours()).padStart(2,"0"),c=String(r.getMinutes()).padStart(2,"0"),h=String(r.getSeconds()).padStart(2,"0");return`${s}-${n}-${o}T${l}:${c}:${h}`}catch{return""}}saveSettings(a){this.validationErrors={};let r=!1;const s=this.setting("wusong8899_tournament.details_url")();if(s&&s.trim())try{new URL(s)}catch{this.validationErrors.details_url=u(e.translator.trans("wusong8899-tournament-widget.admin.validation.invalid_url")),r=!0}const n=this.setting("wusong8899_tournament.background_image")();if(n&&n.trim())try{new URL(n)}catch{this.validationErrors.background_image=u(e.translator.trans("wusong8899-tournament-widget.admin.validation.invalid_url")),r=!0}const o=this.setting("wusong8899_tournament.header_image")();if(o&&o.trim())try{new URL(o)}catch{this.validationErrors.header_image=u(e.translator.trans("wusong8899-tournament-widget.admin.validation.invalid_url")),r=!0}const l=this.setting("wusong8899_tournament.preview_limit")();if(l&&l.trim()){const c=parseInt(l);(isNaN(c)||c<1||c>50)&&(this.validationErrors.preview_limit=u(e.translator.trans("wusong8899-tournament-widget.admin.validation.invalid_preview_limit")),r=!0)}return r?(e.alerts.show({type:"error"},e.translator.trans("wusong8899-tournament-widget.admin.validation.fix_errors")),t.redraw(),Promise.resolve()):super.saveSettings(a).then(()=>{},c=>{console.error("Settings save error:",c);const h=c?.response?.errors?.[0]?.detail||u(e.translator.trans("wusong8899-tournament-widget.admin.settings.save_error"));e.alerts.show({type:"error"},h)})}}class A extends i{constructor(){super(...arguments),this.platformAccount=i.attribute("platformAccount"),this.platformUsername=i.attribute("platformUsername"),this.score=i.attribute("score"),this.initialScore=i.attribute("initialScore"),this.isApproved=i.attribute("isApproved"),this.approvedAt=i.attribute("approvedAt",a=>i.transformDate(a)??null),this.createdAt=i.attribute("createdAt",a=>i.transformDate(a)??null),this.updatedAt=i.attribute("updatedAt",a=>i.transformDate(a)??null),this.user=i.hasOne("user"),this.platform=i.hasOne("platform"),this.approvedBy=i.hasOne("approvedBy")}apiEndpoint(){return"/tournament/participants"}}class B extends i{constructor(){super(...arguments),this.name=i.attribute("name"),this.iconUrl=i.attribute("iconUrl"),this.iconClass=i.attribute("iconClass"),this.isActive=i.attribute("isActive"),this.displayOrder=i.attribute("displayOrder"),this.usesUrlIcon=i.attribute("usesUrlIcon"),this.usesCssIcon=i.attribute("usesCssIcon")}apiEndpoint(){return"/tournament/platforms"}}new T.Store().add("participants",A).add("platforms",B),e.initializers.add("wusong8899-tournament-widget",()=>{e.extensionData.for("wusong8899-tournament-widget").registerPage(U).registerPermission({icon:"fas fa-trophy",label:e.translator.trans("wusong8899-tournament-widget.admin.permissions.participate"),permission:"tournament.participate"},"start").registerPermission({icon:"fas fa-cog",label:e.translator.trans("wusong8899-tournament-widget.admin.permissions.manage_platforms"),permission:"tournament.managePlatforms"},"moderate")})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Select"],flarum.core.compat["common/utils/Stream"],m,flarum.core.compat["common/utils/extractText"],flarum.core.compat["common/Component"],flarum.core.compat["common/components/Switch"],flarum.core.compat["common/extenders"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=admin.js.map

module.exports={};