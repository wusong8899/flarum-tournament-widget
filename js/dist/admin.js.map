{"version":3,"file":"admin.js","sources":["../src/admin/components/PlatformManagement.tsx","../src/admin/components/RankTitleManagement.tsx","../src/admin/components/ParticipantManagement.tsx","../src/admin/components/TournamentManagementPage.tsx","../src/admin/index.ts"],"sourcesContent":["import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Switch from 'flarum/common/components/Switch';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport type Mithril from 'mithril';\r\n\r\ninterface Platform {\r\n  id: number;\r\n  attributes: {\r\n    name: string;\r\n    iconUrl?: string;\r\n    iconClass?: string;\r\n    isActive: boolean;\r\n    displayOrder: number;\r\n  };\r\n}\r\n\r\nexport default class PlatformManagement extends Component {\r\n  private loading = true;\r\n  private platforms: Platform[] = [];\r\n  private newPlatformName = Stream('');\r\n  private newPlatformIconUrl = Stream('');\r\n  private newPlatformIconClass = Stream('');\r\n  private submitting = false;\r\n\r\n  oninit(vnode: Mithril.VnodeDOM) {\r\n    super.oninit(vnode);\r\n    this.loadPlatforms();\r\n  }\r\n\r\n  view(): Mithril.Children {\r\n    if (this.loading) {\r\n      return <LoadingIndicator />;\r\n    }\r\n\r\n    return (\r\n      <div className=\"PlatformManagement\">\r\n        <div className=\"PlatformManagement-header\">\r\n          <h3>{app.translator.trans('wusong8899-tournament-widget.admin.platforms.title')}</h3>\r\n        </div>\r\n\r\n        <div className=\"PlatformManagement-addForm\">\r\n          <h4>{app.translator.trans('wusong8899-tournament-widget.admin.platforms.add_button')}</h4>\r\n          \r\n          <div className=\"Form-group\">\r\n            <label className=\"FormLabel\">{app.translator.trans('wusong8899-tournament-widget.admin.platforms.name_label')}</label>\r\n            <input\r\n              className=\"FormControl\"\r\n              type=\"text\"\r\n              value={this.newPlatformName()}\r\n              onchange={(e: Event) => this.newPlatformName((e.target as HTMLInputElement).value)}\r\n              placeholder={app.translator.trans('wusong8899-tournament-widget.admin.platforms.name_help')}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"Form-group\">\r\n            <label className=\"FormLabel\">{app.translator.trans('wusong8899-tournament-widget.admin.platforms.icon_url_label')}</label>\r\n            <input\r\n              className=\"FormControl\"\r\n              type=\"url\"\r\n              value={this.newPlatformIconUrl()}\r\n              onchange={(e: Event) => this.newPlatformIconUrl((e.target as HTMLInputElement).value)}\r\n              placeholder={app.translator.trans('wusong8899-tournament-widget.admin.platforms.icon_url_help')}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"Form-group\">\r\n            <label className=\"FormLabel\">{app.translator.trans('wusong8899-tournament-widget.admin.platforms.icon_class_label')}</label>\r\n            <input\r\n              className=\"FormControl\"\r\n              type=\"text\"\r\n              value={this.newPlatformIconClass()}\r\n              onchange={(e: Event) => this.newPlatformIconClass((e.target as HTMLInputElement).value)}\r\n              placeholder={app.translator.trans('wusong8899-tournament-widget.admin.platforms.icon_class_help')}\r\n            />\r\n          </div>\r\n\r\n          <Button\r\n            className=\"Button Button--primary\"\r\n            loading={this.submitting}\r\n            onclick={() => this.createPlatform()}\r\n          >\r\n            {app.translator.trans('wusong8899-tournament-widget.admin.platforms.add_button')}\r\n          </Button>\r\n        </div>\r\n\r\n        <div className=\"PlatformManagement-list\">\r\n          <h4>Existing Platforms</h4>\r\n          {this.platforms.length > 0 ? (\r\n            <div className=\"PlatformList\">\r\n              {this.platforms.map((platform) => (\r\n                <div key={platform.id} className=\"PlatformList-item\">\r\n                  <div className=\"platform-info\">\r\n                    <div className=\"platform-icon\">\r\n                      {this.renderPlatformIcon(platform)}\r\n                    </div>\r\n                    <div className=\"platform-details\">\r\n                      <div className=\"platform-name\">{platform.attributes.name}</div>\r\n                      <div className=\"platform-meta\">\r\n                        {platform.attributes.iconUrl && (\r\n                          <span className=\"meta-item\">URL Icon: {platform.attributes.iconUrl}</span>\r\n                        )}\r\n                        {platform.attributes.iconClass && (\r\n                          <span className=\"meta-item\">CSS Icon: {platform.attributes.iconClass}</span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"platform-controls\">\r\n                    <Switch\r\n                      state={platform.attributes.isActive}\r\n                      onchange={(checked: boolean) => this.updatePlatform(platform.id, { isActive: checked })}\r\n                    >\r\n                      {platform.attributes.isActive \r\n                        ? app.translator.trans('wusong8899-tournament-widget.admin.platforms.enable')\r\n                        : app.translator.trans('wusong8899-tournament-widget.admin.platforms.disable')\r\n                      }\r\n                    </Switch>\r\n                    <Button\r\n                      className=\"Button Button--danger Button--icon\"\r\n                      icon=\"fas fa-trash\"\r\n                      onclick={() => this.deletePlatform(platform.id)}\r\n                      title=\"Delete Platform\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"PlatformList-empty\">\r\n              {app.translator.trans('wusong8899-tournament-widget.admin.platforms.empty')}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private async loadPlatforms(): Promise<void> {\r\n    try {\r\n      const response = await app.request({\r\n        method: 'GET',\r\n        url: app.forum.attribute('apiUrl') + '/tournament/platforms'\r\n      });\r\n\r\n      this.platforms = response.data || [];\r\n      this.loading = false;\r\n      m.redraw();\r\n    } catch (error) {\r\n      console.error('Failed to load platforms:', error);\r\n      this.loading = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private async createPlatform(): Promise<void> {\r\n    if (!this.newPlatformName().trim()) {\r\n      app.alerts.show({ type: 'error' }, 'Platform name is required');\r\n      return;\r\n    }\r\n\r\n    this.submitting = true;\r\n    m.redraw();\r\n\r\n    try {\r\n      const response = await app.request({\r\n        method: 'POST',\r\n        url: app.forum.attribute('apiUrl') + '/tournament/platforms',\r\n        body: {\r\n          data: {\r\n            type: 'platforms',\r\n            attributes: {\r\n              name: this.newPlatformName(),\r\n              iconUrl: this.newPlatformIconUrl() || null,\r\n              iconClass: this.newPlatformIconClass() || null,\r\n              isActive: true,\r\n              displayOrder: this.platforms.length\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      this.platforms.push(response.data);\r\n      \r\n      // Clear form\r\n      this.newPlatformName('');\r\n      this.newPlatformIconUrl('');\r\n      this.newPlatformIconClass('');\r\n\r\n      app.alerts.show({ type: 'success' }, 'Platform created successfully');\r\n    } catch (error) {\r\n      console.error('Failed to create platform:', error);\r\n      app.alerts.show({ type: 'error' }, 'Failed to create platform');\r\n    } finally {\r\n      this.submitting = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private async updatePlatform(id: number, attributes: Partial<Platform['attributes']>): Promise<void> {\r\n    try {\r\n      const response = await app.request({\r\n        method: 'PATCH',\r\n        url: app.forum.attribute('apiUrl') + `/tournament/platforms/` + id,\r\n        body: {\r\n          data: {\r\n            type: 'platforms',\r\n            attributes\r\n          }\r\n        }\r\n      });\r\n\r\n      // Update platform in list\r\n      const index = this.platforms.findIndex(p => p.id === id);\r\n      if (index !== -1) {\r\n        this.platforms[index] = response.data;\r\n        m.redraw();\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to update platform:', error);\r\n      app.alerts.show({ type: 'error' }, 'Failed to update platform');\r\n    }\r\n  }\r\n\r\n  private async deletePlatform(id: number): Promise<void> {\r\n    if (!confirm('Are you sure you want to delete this platform?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await app.request({\r\n        method: 'DELETE',\r\n        url: app.forum.attribute('apiUrl') + `/tournament/platforms/${id}`\r\n      });\r\n\r\n      this.platforms = this.platforms.filter(p => p.id !== id);\r\n      app.alerts.show({ type: 'success' }, 'Platform deleted successfully');\r\n      m.redraw();\r\n    } catch (error) {\r\n      console.error('Failed to delete platform:', error);\r\n      app.alerts.show({ type: 'error' }, 'Failed to delete platform');\r\n    }\r\n  }\r\n\r\n  private renderPlatformIcon(platform: Platform): Mithril.Children {\r\n    const { iconUrl, iconClass } = platform.attributes;\r\n    \r\n    if (iconUrl) {\r\n      return <img src={iconUrl} alt={platform.attributes.name} className=\"platform-icon-img\" />;\r\n    } else if (iconClass) {\r\n      return <i className={`platform-icon-css ${iconClass}`}></i>;\r\n    } else {\r\n      return <i className=\"platform-icon-css fas fa-gamepad\"></i>;\r\n    }\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport type Mithril from 'mithril';\r\n\r\ninterface RankTitleEntry {\r\n  id: string;\r\n  rank: string;\r\n  title: string;\r\n}\r\n\r\nexport default class RankTitleManagement extends Component {\r\n  private loading = true;\r\n  private saving = false;\r\n  private rankTitles: { [key: string]: string } = {};\r\n  private entries: RankTitleEntry[] = [];\r\n  private nextId = 1;\r\n\r\n  oninit(vnode: Mithril.VnodeDOM) {\r\n    super.oninit(vnode);\r\n    this.loadRankTitles();\r\n  }\r\n\r\n  view(): Mithril.Children {\r\n    if (this.loading) {\r\n      return <LoadingIndicator />;\r\n    }\r\n\r\n    return (\r\n      <div className=\"RankTitleManagement\">\r\n        <div className=\"RankTitleManagement-header\">\r\n          <h3>{app.translator.trans('wusong8899-tournament-widget.admin.rank_titles.title')}</h3>\r\n          <div className=\"helpText\">\r\n            {app.translator.trans('wusong8899-tournament-widget.admin.rank_titles.help')}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"RankTitleManagement-list\">\r\n          <div className=\"RankTitleManagement-listHeader\">\r\n            <div className=\"rank-column\">{app.translator.trans('wusong8899-tournament-widget.admin.rank_titles.rank_label')}</div>\r\n            <div className=\"title-column\">{app.translator.trans('wusong8899-tournament-widget.admin.rank_titles.title_label')}</div>\r\n            <div className=\"actions-column\">Actions</div>\r\n          </div>\r\n\r\n          {this.entries.map((entry) => (\r\n            <div key={entry.id} className=\"RankTitleManagement-entry\">\r\n              <div className=\"rank-column\">\r\n                <input\r\n                  className=\"FormControl\"\r\n                  type=\"text\"\r\n                  value={entry.rank}\r\n                  placeholder=\"1, 2-5, default\"\r\n                  onchange={(e: Event) => this.updateEntryRank(entry.id, (e.target as HTMLInputElement).value)}\r\n                />\r\n              </div>\r\n              <div className=\"title-column\">\r\n                <input\r\n                  className=\"FormControl\"\r\n                  type=\"text\"\r\n                  value={entry.title}\r\n                  placeholder={app.translator.trans('wusong8899-tournament-widget.admin.rank_titles.title_placeholder')}\r\n                  onchange={(e: Event) => this.updateEntryTitle(entry.id, (e.target as HTMLInputElement).value)}\r\n                />\r\n              </div>\r\n              <div className=\"actions-column\">\r\n                <Button\r\n                  className=\"Button Button--icon\"\r\n                  icon=\"fas fa-times\"\r\n                  onclick={() => this.removeEntry(entry.id)}\r\n                  title=\"Remove\"\r\n                />\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        <div className=\"RankTitleManagement-actions\">\r\n          <Button\r\n            className=\"Button\"\r\n            icon=\"fas fa-plus\"\r\n            onclick={() => this.addEntry()}\r\n          >\r\n            {app.translator.trans('wusong8899-tournament-widget.admin.rank_titles.add_rank')}\r\n          </Button>\r\n\r\n          <Button\r\n            className=\"Button Button--primary\"\r\n            loading={this.saving}\r\n            onclick={() => this.saveRankTitles()}\r\n          >\r\n            {app.translator.trans('wusong8899-tournament-widget.admin.rank_titles.save_button')}\r\n          </Button>\r\n        </div>\r\n\r\n        <div className=\"RankTitleManagement-preview\">\r\n          <h4>{app.translator.trans('wusong8899-tournament-widget.admin.rank_titles.preview_title')}</h4>\r\n          <div className=\"preview-content\">\r\n            {this.renderPreview()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private async loadRankTitles(): Promise<void> {\r\n    try {\r\n      const response = await app.request({\r\n        method: 'GET',\r\n        url: app.forum.attribute('apiUrl') + '/tournament/rank-titles'\r\n      });\r\n\r\n      this.rankTitles = response.data.attributes.rankTitles || {};\r\n      this.entriesFromRankTitles();\r\n      this.loading = false;\r\n      m.redraw();\r\n    } catch (error) {\r\n      console.error('Failed to load rank titles:', error);\r\n      this.loading = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private entriesFromRankTitles(): void {\r\n    this.entries = [];\r\n    this.nextId = 1;\r\n\r\n    Object.entries(this.rankTitles).forEach(([rank, title]) => {\r\n      this.entries.push({\r\n        id: String(this.nextId++),\r\n        rank,\r\n        title\r\n      });\r\n    });\r\n\r\n    // Add empty entry if no entries exist\r\n    if (this.entries.length === 0) {\r\n      this.addEntry();\r\n    }\r\n  }\r\n\r\n  private addEntry(): void {\r\n    this.entries.push({\r\n      id: String(this.nextId++),\r\n      rank: '',\r\n      title: ''\r\n    });\r\n    m.redraw();\r\n  }\r\n\r\n  private removeEntry(id: string): void {\r\n    this.entries = this.entries.filter(entry => entry.id !== id);\r\n    m.redraw();\r\n  }\r\n\r\n  private updateEntryRank(id: string, rank: string): void {\r\n    const entry = this.entries.find(e => e.id === id);\r\n    if (entry) {\r\n      entry.rank = rank;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private updateEntryTitle(id: string, title: string): void {\r\n    const entry = this.entries.find(e => e.id === id);\r\n    if (entry) {\r\n      entry.title = title;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private async saveRankTitles(): Promise<void> {\r\n    this.saving = true;\r\n    m.redraw();\r\n\r\n    // Convert entries to rank titles object\r\n    const rankTitles: { [key: string]: string } = {};\r\n    this.entries.forEach(entry => {\r\n      if (entry.rank.trim() && entry.title.trim()) {\r\n        rankTitles[entry.rank.trim()] = entry.title.trim();\r\n      }\r\n    });\r\n\r\n    try {\r\n      await app.request({\r\n        method: 'POST',\r\n        url: app.forum.attribute('apiUrl') + '/tournament/rank-titles',\r\n        body: {\r\n          data: {\r\n            type: 'rank-titles',\r\n            attributes: {\r\n              rankTitles\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      this.rankTitles = rankTitles;\r\n      app.alerts.show({ type: 'success' }, app.translator.trans('core.admin.saved_message'));\r\n    } catch (error) {\r\n      console.error('Failed to save rank titles:', error);\r\n      app.alerts.show({ type: 'error' }, 'Failed to save rank titles');\r\n    } finally {\r\n      this.saving = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private renderPreview(): Mithril.Children {\r\n    const previewRanks = [1, 2, 3, 5, 15, 25];\r\n    \r\n    return (\r\n      <div className=\"preview-list\">\r\n        {previewRanks.map(rank => {\r\n          const title = this.getTitleForRank(rank);\r\n          return (\r\n            <div key={rank} className=\"preview-item\">\r\n              <span className=\"preview-rank\">#{rank}</span>\r\n              <span className=\"preview-title\">{title}</span>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private getTitleForRank(rank: number): string {\r\n    // Use current entries to determine title\r\n    const rankTitles: { [key: string]: string } = {};\r\n    this.entries.forEach(entry => {\r\n      if (entry.rank.trim() && entry.title.trim()) {\r\n        rankTitles[entry.rank.trim()] = entry.title.trim();\r\n      }\r\n    });\r\n\r\n    // Check exact match first\r\n    if (rankTitles[String(rank)]) {\r\n      return rankTitles[String(rank)];\r\n    }\r\n\r\n    // Check ranges\r\n    for (const [key, title] of Object.entries(rankTitles)) {\r\n      if (key.includes('-')) {\r\n        const [start, end] = key.split('-').map(Number);\r\n        if (rank >= start && rank <= end) {\r\n          return title;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Return default\r\n    return rankTitles.default || '参赛选手';\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport type Mithril from 'mithril';\r\n\r\ninterface Participant {\r\n  id: number;\r\n  score: number;\r\n  platformUsername: string;\r\n  createdAt: string;\r\n  user: {\r\n    id: number;\r\n    username: string;\r\n    displayName: string;\r\n    avatarUrl?: string;\r\n  };\r\n  platform?: {\r\n    id: number;\r\n    name: string;\r\n  };\r\n}\r\n\r\nexport default class ParticipantManagement extends Component {\r\n  private participants: Participant[] = [];\r\n  private loading = false;\r\n  private saving = false;\r\n  private deleting = false;\r\n  private editingScores: Record<number, number> = {};\r\n\r\n  oninit(vnode: Mithril.VnodeDOM) {\r\n    super.oninit(vnode);\r\n    this.loadParticipants();\r\n  }\r\n\r\n  view() {\r\n    if (this.loading) {\r\n      return <LoadingIndicator />;\r\n    }\r\n\r\n    return (\r\n      <div className=\"ParticipantManagement\">\r\n        <div className=\"ParticipantManagement-header\">\r\n          <h3>{app.translator.trans('wusong8899-tournament-widget.admin.participants.title')}</h3>\r\n          <p className=\"helpText\">\r\n            {app.translator.trans('wusong8899-tournament-widget.admin.participants.description')}\r\n          </p>\r\n        </div>\r\n\r\n        {this.participants.length === 0 ? (\r\n          <div className=\"ParticipantManagement-empty\">\r\n            <p>{app.translator.trans('wusong8899-tournament-widget.admin.participants.no_participants')}</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"ParticipantManagement-table\">\r\n            <table className=\"Table\">\r\n              <thead>\r\n                <tr>\r\n                  <th>{app.translator.trans('wusong8899-tournament-widget.admin.participants.user')}</th>\r\n                  <th>{app.translator.trans('wusong8899-tournament-widget.admin.participants.platform')}</th>\r\n                  <th>{app.translator.trans('wusong8899-tournament-widget.admin.participants.score')}</th>\r\n                  <th>{app.translator.trans('wusong8899-tournament-widget.admin.participants.actions')}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {this.participants.map((participant) => (\r\n                  <tr key={participant.id}>\r\n                    <td>\r\n                      <div className=\"ParticipantManagement-user\">\r\n                        {participant.user.avatarUrl && (\r\n                          <img\r\n                            src={participant.user.avatarUrl}\r\n                            alt={participant.user.displayName}\r\n                            className=\"Avatar Avatar--size-small\"\r\n                          />\r\n                        )}\r\n                        <span className=\"username\">\r\n                          {participant.user.displayName || participant.user.username}\r\n                        </span>\r\n                      </div>\r\n                    </td>\r\n                    <td>\r\n                      <div className=\"ParticipantManagement-platform\">\r\n                        <span className=\"platform-name\">\r\n                          {participant.platform?.name || 'Unknown'}\r\n                        </span>\r\n                        {participant.platformUsername && (\r\n                          <span className=\"platform-username\">\r\n                            ({participant.platformUsername})\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n                    <td>\r\n                      <input\r\n                        type=\"number\"\r\n                        className=\"FormControl FormControl--compact\"\r\n                        value={this.editingScores[participant.id] ?? participant.score}\r\n                        oninput={(e: Event) => {\r\n                          const target = e.target as HTMLInputElement;\r\n                          this.editingScores[participant.id] = parseInt(target.value) || 0;\r\n                        }}\r\n                        min=\"0\"\r\n                      />\r\n                    </td>\r\n                    <td>\r\n                      <div style=\"display: flex; gap: 8px; justify-content: center;\">\r\n                        <Button\r\n                          className=\"Button Button--primary Button--size-small\"\r\n                          loading={this.saving}\r\n                          disabled={this.saving || this.deleting}\r\n                          onclick={() => this.updateScore(participant)}\r\n                        >\r\n                          {app.translator.trans('wusong8899-tournament-widget.admin.participants.update')}\r\n                        </Button>\r\n                        <Button\r\n                          className=\"Button Button--danger Button--size-small\"\r\n                          loading={this.deleting}\r\n                          disabled={this.saving || this.deleting}\r\n                          onclick={() => this.confirmDeleteParticipant(participant)}\r\n                        >\r\n                          {app.translator.trans('wusong8899-tournament-widget.admin.participants.remove')}\r\n                        </Button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"ParticipantManagement-actions\">\r\n          <Button\r\n            className=\"Button\"\r\n            onclick={() => this.loadParticipants()}\r\n            loading={this.loading}\r\n          >\r\n            {app.translator.trans('wusong8899-tournament-widget.admin.participants.refresh')}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private async loadParticipants(): Promise<void> {\r\n    this.loading = true;\r\n    m.redraw();\r\n\r\n    try {\r\n      const response = await app.request({\r\n        method: 'GET',\r\n        url: `${app.forum.attribute('apiUrl')}/tournament/participants?include=user,platform`,\r\n      });\r\n\r\n      // Handle included data properly\r\n      const included = response.included || [];\r\n      const users = included.filter((item: any) => item.type === 'users');\r\n      const platforms = included.filter((item: any) => item.type === 'platforms');\r\n\r\n      this.participants = response.data.map((item: any) => {\r\n        // Find related user\r\n        const userId = item.relationships?.user?.data?.id;\r\n        const user = users.find((u: any) => u.id === userId);\r\n        \r\n        // Find related platform\r\n        const platformId = item.relationships?.platform?.data?.id;\r\n        const platform = platforms.find((p: any) => p.id === platformId);\r\n\r\n        return {\r\n          id: parseInt(item.id),\r\n          score: item.attributes.score,\r\n          platformUsername: item.attributes.platformUsername,\r\n          createdAt: item.attributes.createdAt,\r\n          user: user ? {\r\n            id: parseInt(user.id),\r\n            username: user.attributes?.username || 'Unknown',\r\n            displayName: user.attributes?.displayName || 'Unknown',\r\n            avatarUrl: user.attributes?.avatarUrl,\r\n          } : {\r\n            id: 0,\r\n            username: 'Deleted User',\r\n            displayName: 'Deleted User',\r\n          },\r\n          platform: platform ? {\r\n            id: parseInt(platform.id),\r\n            name: platform.attributes?.name || 'Unknown',\r\n          } : undefined,\r\n        };\r\n      });\r\n\r\n      // Initialize editing scores\r\n      this.editingScores = {};\r\n      this.participants.forEach(participant => {\r\n        this.editingScores[participant.id] = participant.score;\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to load participants:', error);\r\n      app.alerts.show({ type: 'error' }, app.translator.trans('wusong8899-tournament-widget.admin.participants.load_error'));\r\n    } finally {\r\n      this.loading = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private async updateScore(participant: Participant): Promise<void> {\r\n    const newScore = this.editingScores[participant.id];\r\n    if (newScore === participant.score) {\r\n      return; // No change\r\n    }\r\n\r\n    this.saving = true;\r\n    m.redraw();\r\n\r\n    try {\r\n      await app.request({\r\n        method: 'PATCH',\r\n        url: `${app.forum.attribute('apiUrl')}/tournament/participants/${participant.id}`,\r\n        body: {\r\n          data: {\r\n            type: 'participants',\r\n            attributes: {\r\n              score: newScore,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      // Update local state\r\n      participant.score = newScore;\r\n      app.alerts.show({ type: 'success' }, app.translator.trans('wusong8899-tournament-widget.admin.participants.update_success'));\r\n    } catch (error) {\r\n      console.error('Failed to update score:', error);\r\n      app.alerts.show({ type: 'error' }, app.translator.trans('wusong8899-tournament-widget.admin.participants.update_error'));\r\n      // Revert editing score on error\r\n      this.editingScores[participant.id] = participant.score;\r\n    } finally {\r\n      this.saving = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  private confirmDeleteParticipant(participant: Participant): void {\r\n    const confirmMessage = app.translator.trans(\r\n      'wusong8899-tournament-widget.admin.participants.confirm_remove',\r\n      { username: participant.user.displayName || participant.user.username }\r\n    );\r\n\r\n    if (confirm(confirmMessage)) {\r\n      this.deleteParticipant(participant);\r\n    }\r\n  }\r\n\r\n  private async deleteParticipant(participant: Participant): Promise<void> {\r\n    this.deleting = true;\r\n    m.redraw();\r\n\r\n    try {\r\n      await app.request({\r\n        method: 'DELETE',\r\n        url: `${app.forum.attribute('apiUrl')}/tournament/participants/${participant.id}`\r\n      });\r\n\r\n      // Remove participant from local state\r\n      this.participants = this.participants.filter(p => p.id !== participant.id);\r\n      delete this.editingScores[participant.id];\r\n\r\n      app.alerts.show(\r\n        { type: 'success' },\r\n        app.translator.trans('wusong8899-tournament-widget.admin.participants.remove_success')\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to delete participant:', error);\r\n      app.alerts.show(\r\n        { type: 'error' },\r\n        app.translator.trans('wusong8899-tournament-widget.admin.participants.remove_error')\r\n      );\r\n    } finally {\r\n      this.deleting = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\r\nimport Button from 'flarum/common/components/Button';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport type Mithril from 'mithril';\r\nimport PlatformManagement from './PlatformManagement';\r\nimport RankTitleManagement from './RankTitleManagement';\r\nimport ParticipantManagement from './ParticipantManagement';\r\n\r\nexport default class TournamentManagementPage extends ExtensionPage {\r\n  private activeTab = Stream('general');\r\n  private loading = false;\r\n\r\n  oninit(vnode: Mithril.VnodeDOM) {\r\n    super.oninit(vnode);\r\n    app.setTitle(app.translator.trans('wusong8899-tournament-widget.admin.title'));\r\n  }\r\n\r\n  content() {\r\n    if (this.loading) {\r\n      return <LoadingIndicator />;\r\n    }\r\n\r\n    return (\r\n      <div className=\"TournamentManagementPage\">\r\n        <div className=\"container\">\r\n          <div className=\"TournamentManagementPage-header\">\r\n            <h2>{app.translator.trans('wusong8899-tournament-widget.admin.title')}</h2>\r\n            <p className=\"helpText\">\r\n              {app.translator.trans('wusong8899-tournament-widget.admin.description')}\r\n            </p>\r\n          </div>\r\n\r\n          <nav className=\"TournamentManagementPage-tabs\">\r\n            {this.renderTab('general', 'wusong8899-tournament-widget.admin.tabs.general')}\r\n            {this.renderTab('platforms', 'wusong8899-tournament-widget.admin.tabs.platforms')}\r\n            {this.renderTab('rank_titles', 'wusong8899-tournament-widget.admin.tabs.rank_titles')}\r\n            {this.renderTab('participants', 'wusong8899-tournament-widget.admin.tabs.participants')}\r\n          </nav>\r\n\r\n          <div className=\"TournamentManagementPage-content\">\r\n            {this.renderTabContent()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderTab(tabName: string, labelKey: string): Mithril.Children {\r\n    const isActive = this.activeTab() === tabName;\r\n    \r\n    return (\r\n      <Button\r\n        className={`Button Button--text TournamentManagementPage-tab ${isActive ? 'active' : ''}`}\r\n        onclick={() => this.activeTab(tabName)}\r\n      >\r\n        {app.translator.trans(labelKey)}\r\n      </Button>\r\n    );\r\n  }\r\n\r\n  private renderTabContent(): Mithril.Children {\r\n    switch (this.activeTab()) {\r\n      case 'general':\r\n        return this.renderGeneralSettings();\r\n      case 'platforms':\r\n        return <PlatformManagement />;\r\n      case 'rank_titles':\r\n        return <RankTitleManagement />;\r\n      case 'participants':\r\n        return <ParticipantManagement />;\r\n      default:\r\n        return this.renderGeneralSettings();\r\n    }\r\n  }\r\n\r\n  private renderGeneralSettings(): Mithril.Children {\r\n    return (\r\n      <div className=\"TournamentManagementPage-generalSettings\">\r\n        <div className=\"Form\">\r\n          <div className=\"Form-group\">\r\n            <label className=\"FormLabel\">{app.translator.trans('wusong8899-tournament-widget.admin.settings.title_label')}</label>\r\n            <input\r\n              className=\"FormControl\"\r\n              type=\"text\"\r\n              value={this.setting('wusong8899_tournament.title')()}\r\n              onchange={(e: Event) => this.setting('wusong8899_tournament.title')((e.target as HTMLInputElement).value)}\r\n            />\r\n            <div className=\"helpText\">\r\n              {app.translator.trans('wusong8899-tournament-widget.admin.settings.title_help')}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"Form-group\">\r\n            <label className=\"FormLabel\">{app.translator.trans('wusong8899-tournament-widget.admin.settings.prize_pool_label')}</label>\r\n            <input\r\n              className=\"FormControl\"\r\n              type=\"text\"\r\n              value={this.setting('wusong8899_tournament.prize_pool')()}\r\n              onchange={(e: Event) => this.setting('wusong8899_tournament.prize_pool')((e.target as HTMLInputElement).value)}\r\n            />\r\n            <div className=\"helpText\">\r\n              {app.translator.trans('wusong8899-tournament-widget.admin.settings.prize_pool_help')}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"Form-group\">\r\n            <label className=\"FormLabel\">{app.translator.trans('wusong8899-tournament-widget.admin.settings.start_date_label')}</label>\r\n            <input\r\n              className=\"FormControl\"\r\n              type=\"text\"\r\n              value={this.setting('wusong8899_tournament.start_date')()}\r\n              onchange={(e: Event) => this.setting('wusong8899_tournament.start_date')((e.target as HTMLInputElement).value)}\r\n            />\r\n            <div className=\"helpText\">\r\n              {app.translator.trans('wusong8899-tournament-widget.admin.settings.start_date_help')}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"Form-group\">\r\n            <label className=\"FormLabel\">{app.translator.trans('wusong8899-tournament-widget.admin.settings.details_url_label')}</label>\r\n            <input\r\n              className=\"FormControl\"\r\n              type=\"url\"\r\n              value={this.setting('wusong8899_tournament.details_url')()}\r\n              onchange={(e: Event) => this.setting('wusong8899_tournament.details_url')((e.target as HTMLInputElement).value)}\r\n            />\r\n            <div className=\"helpText\">\r\n              {app.translator.trans('wusong8899-tournament-widget.admin.settings.details_url_help')}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"Form-group\">\r\n            <label className=\"FormLabel\">{app.translator.trans('wusong8899-tournament-widget.admin.settings.background_image_label')}</label>\r\n            <input\r\n              className=\"FormControl\"\r\n              type=\"url\"\r\n              value={this.setting('wusong8899_tournament.background_image')()}\r\n              onchange={(e: Event) => this.setting('wusong8899_tournament.background_image')((e.target as HTMLInputElement).value)}\r\n            />\r\n            <div className=\"helpText\">\r\n              {app.translator.trans('wusong8899-tournament-widget.admin.settings.background_image_help')}\r\n            </div>\r\n          </div>\r\n\r\n          {this.submitButton()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","import app from 'flarum/admin/app';\r\nimport TournamentManagementPage from './components/TournamentManagementPage';\r\n\r\napp.initializers.add('wusong8899-tournament-widget', () => {\r\n  app.extensionData\r\n    .for('wusong8899-tournament-widget')\r\n    .registerPage(TournamentManagementPage)\r\n    .registerPermission({\r\n      icon: 'fas fa-trophy',\r\n      label: app.translator.trans('wusong8899-tournament-widget.admin.permissions.participate'),\r\n      permission: 'tournament.participate',\r\n    }, 'start')\r\n    .registerPermission({\r\n      icon: 'fas fa-cog',\r\n      label: app.translator.trans('wusong8899-tournament-widget.admin.permissions.manage_platforms'),\r\n      permission: 'tournament.managePlatforms',\r\n    }, 'moderate');\r\n});"],"names":["PlatformManagement","Component","Stream","vnode","LoadingIndicator","app","e","Button","platform","Switch","checked","response","error","id","attributes","index","p","iconUrl","iconClass","RankTitleManagement","entry","rank","title","rankTitles","previewRanks","key","start","end","ParticipantManagement","participant","_a","target","included","users","item","platforms","userId","_c","_b","user","u","platformId","_f","_e","_d","_g","_h","_i","_j","newScore","confirmMessage","TournamentManagementPage","ExtensionPage","tabName","labelKey","isActive"],"mappings":"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"}