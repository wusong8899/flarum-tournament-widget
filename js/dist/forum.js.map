{"version":3,"file":"forum.js","sources":["../src/forum/components/PlatformIcon.tsx","../src/forum/components/PlatformSelector.tsx","../src/forum/components/ParticipateModal.tsx","../src/common/colors.ts","../src/forum/components/TournamentCard.tsx","../src/forum/components/TournamentRankingsModal.tsx","../src/forum/components/Leaderboard.tsx","../src/forum/components/TournamentWidget.tsx","../src/forum/index.ts"],"sourcesContent":["import icon from 'flarum/common/helpers/icon';\r\nimport type { TournamentPlatform } from '../types';\r\n\r\ninterface PlatformIconProps {\r\n  platform: TournamentPlatform | null;\r\n  size?: 'small' | 'medium' | 'large';\r\n}\r\n\r\nexport default class PlatformIcon {\r\n  view({ attrs }: { attrs: PlatformIconProps }) {\r\n    const { platform, size = 'medium' } = attrs;\r\n    \r\n    if (!platform) {\r\n      return icon('fas fa-gamepad', { className: `PlatformIcon PlatformIcon--${size}` });\r\n    }\r\n\r\n    const className = `PlatformIcon PlatformIcon--${size}`;\r\n\r\n    // Use image URL if available\r\n    if (platform.iconUrl) {\r\n      return (\r\n        <img \r\n          src={platform.iconUrl}\r\n          alt={platform.name}\r\n          className={className}\r\n        />\r\n      );\r\n    }\r\n\r\n    // Use FontAwesome class if available\r\n    if (platform.iconClass) {\r\n      return icon(platform.iconClass, { className });\r\n    }\r\n\r\n    // Fallback to generic gamepad icon\r\n    return icon('fas fa-gamepad', { className });\r\n  }\r\n}","import Component from 'flarum/common/Component';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport type Mithril from 'mithril';\r\nimport type { TournamentPlatform } from '../types';\r\nimport PlatformIcon from './PlatformIcon';\r\n\r\ninterface PlatformSelectorProps {\r\n  platforms: TournamentPlatform[];\r\n  selectedPlatform: TournamentPlatform | null;\r\n  onPlatformSelect: (platform: TournamentPlatform) => void;\r\n}\r\n\r\ninterface PlatformSelectorState {\r\n  showDropdown: boolean;\r\n}\r\n\r\nexport default class PlatformSelector extends Component<PlatformSelectorProps, PlatformSelectorState> {\r\n  oninit(vnode: Mithril.Vnode<PlatformSelectorProps, PlatformSelectorState>) {\r\n    super.oninit(vnode);\r\n    this.state = {\r\n      showDropdown: false,\r\n    };\r\n  }\r\n\r\n  view(): Mithril.Children {\r\n    const { selectedPlatform } = this.attrs;\r\n    const { showDropdown } = this.state;\r\n\r\n    return (\r\n      <div className=\"TournamentPlatformSelector\">\r\n        <div className=\"TournamentPlatformSelector-label\">游戏平台</div>\r\n        <div \r\n          className=\"TournamentPlatformSelector-dropdown\" \r\n          onclick={() => this.toggleDropdown()}\r\n        >\r\n          <div className=\"TournamentPlatformSelector-selected\">\r\n            <div className=\"TournamentPlatformSelector-info\">\r\n              <div className=\"TournamentPlatformSelector-icon\">\r\n                <PlatformIcon \r\n                  platform={selectedPlatform} \r\n                  size=\"medium\"\r\n                />\r\n              </div>\r\n              <div className=\"TournamentPlatformSelector-details\">\r\n                <div className=\"TournamentPlatformSelector-name\">\r\n                  {this.getPlatformName(selectedPlatform)}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          {icon('fas fa-chevron-down', { className: 'TournamentPlatformSelector-dropdownIcon' })}\r\n        </div>\r\n\r\n        {showDropdown && this.renderPlatformDropdown()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private toggleDropdown(): void {\r\n    this.state.showDropdown = !this.state.showDropdown;\r\n  }\r\n\r\n  private getPlatformName(platform: TournamentPlatform | null): string {\r\n    if (!platform) {\r\n      return '请选择游戏平台';\r\n    }\r\n    return platform.name || '请选择游戏平台';\r\n  }\r\n\r\n  private renderPlatformDropdown(): Mithril.Children {\r\n    const { platforms } = this.attrs;\r\n\r\n    if (!platforms || platforms.length === 0) {\r\n      return (\r\n        <div className=\"TournamentPlatformSelector-dropdownMenu\">\r\n          <div className=\"TournamentPlatformSelector-dropdownItem TournamentPlatformSelector-noData\">\r\n            暂无可选平台\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"TournamentPlatformSelector-dropdownMenu\">\r\n        {platforms.map(platform => (\r\n          <div \r\n            key={platform.id}\r\n            className=\"TournamentPlatformSelector-dropdownItem\"\r\n            onclick={() => this.selectPlatform(platform)}\r\n          >\r\n            <div className=\"TournamentPlatformSelector-icon\">\r\n              <PlatformIcon platform={platform} size=\"small\" />\r\n            </div>\r\n            <div className=\"TournamentPlatformSelector-name\">\r\n              {platform.name}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private selectPlatform(platform: TournamentPlatform): void {\r\n    const { onPlatformSelect } = this.attrs;\r\n    \r\n    onPlatformSelect(platform);\r\n    this.state.showDropdown = false;\r\n  }\r\n}","import app from 'flarum/forum/app';\r\nimport Modal from 'flarum/common/components/Modal';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Stream from 'flarum/common/utils/Stream';\r\nimport m from 'mithril';\r\nimport { Vnode } from 'mithril';\r\nimport PlatformSelector from './PlatformSelector';\r\nimport type { TournamentPlatform } from '../types';\r\n\r\ninterface ParticipateModalAttrs {\r\n  onParticipate?: () => void;\r\n}\r\n\r\nexport default class ParticipateModal extends Modal<ParticipateModalAttrs> {\r\n  platformAccount: string = '';\r\n  platformUsername: Stream<string> = Stream('');\r\n  winLossAmount: Stream<number> = Stream(0);\r\n  winLossAmountText: Stream<string> = Stream('0');\r\n  selectedPlatform: TournamentPlatform | null = null;\r\n  platforms: TournamentPlatform[] = [];\r\n  loading: boolean = false;\r\n  loadingPlatforms: boolean = true;\r\n  errors: Record<string, string> = {};\r\n\r\n  oninit(vnode: Vnode<ParticipateModalAttrs>) {\r\n    super.oninit(vnode);\r\n    this.loadPlatforms();\r\n  }\r\n\r\n  className() {\r\n    return 'ParticipateModal Modal--small';\r\n  }\r\n\r\n  title() {\r\n    return app.translator.trans('wusong8899-tournament-widget.forum.participate_modal.title');\r\n  }\r\n\r\n  content() {\r\n    if (this.loadingPlatforms) {\r\n      return (\r\n        <div className=\"Modal-body\">\r\n          <div className=\"LoadingIndicator\"></div>\r\n          <p>加载平台信息中...</p>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"Modal-body\">\r\n        <div className=\"Form\">\r\n          <div className=\"Form-group\">\r\n            <PlatformSelector\r\n              platforms={this.platforms}\r\n              selectedPlatform={this.selectedPlatform}\r\n              onPlatformSelect={(platform) => this.onPlatformSelect(platform)}\r\n            />\r\n            {this.errors.platform && (\r\n              <div className=\"Alert Alert--error\" style={{ marginTop: '8px' }}>\r\n                {this.errors.platform}\r\n              </div>\r\n            )}\r\n            {this.errors.platformId && (\r\n              <div className=\"Alert Alert--error\" style={{ marginTop: '8px' }}>\r\n                {this.errors.platformId}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div className=\"Form-group\">\r\n            <label className=\"FormLabel\">平台用户名</label>\r\n            <input\r\n              className={this.errors.platformUsername ? 'FormControl FormControl--error' : 'FormControl'}\r\n              type=\"text\"\r\n              placeholder=\"请输入您在该平台的用户名（支持中文、英文、数字等任意字符）\"\r\n              bidi={this.platformUsername}\r\n              oninput={() => {\r\n                // Clear error when user starts typing\r\n                if (this.errors.platformUsername) {\r\n                  delete this.errors.platformUsername;\r\n                  m.redraw();\r\n                }\r\n              }}\r\n            />\r\n            {this.errors.platformUsername && (\r\n              <div className=\"Alert Alert--error\" style={{ marginTop: '8px' }}>\r\n                {this.errors.platformUsername}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div className=\"Form-group\">\r\n            <label className=\"FormLabel\">{app.translator.trans('wusong8899-tournament-widget.forum.participate_modal.win_loss_amount_label')}</label>\r\n            <input\r\n              className={this.errors.winLossAmount ? 'FormControl FormControl--error' : 'FormControl'}\r\n              type=\"number\"\r\n              placeholder={app.translator.trans('wusong8899-tournament-widget.forum.participate_modal.win_loss_amount_placeholder')}\r\n              value={this.winLossAmountText()}\r\n              oninput={(e: Event) => {\r\n                const value = (e.target as HTMLInputElement).value;\r\n                this.winLossAmountText(value);\r\n                \r\n                // Update the numeric Stream with converted value\r\n                if (value === '' || value === '-') {\r\n                  this.winLossAmount(0);\r\n                } else {\r\n                  const numValue = parseInt(value) || 0;\r\n                  this.winLossAmount(numValue);\r\n                }\r\n                \r\n                // Clear error when user starts typing\r\n                if (this.errors.winLossAmount) {\r\n                  delete this.errors.winLossAmount;\r\n                  m.redraw();\r\n                }\r\n              }}\r\n            />\r\n            {this.errors.winLossAmount && (\r\n              <div className=\"Alert Alert--error\" style={{ marginTop: '8px' }}>\r\n                {this.errors.winLossAmount}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div className=\"Form-group\">\r\n            <Button\r\n              className=\"Button Button--primary\"\r\n              type=\"submit\"\r\n              loading={this.loading}\r\n              disabled={!this.selectedPlatform || !this.platformUsername().trim()}\r\n              onclick={this.onsubmit.bind(this)}\r\n            >\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.participate_modal.submit')}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  onsubmit(e: Event) {\r\n    e.preventDefault();\r\n    \r\n    // Clear previous errors\r\n    this.errors = {};\r\n    \r\n    // Client-side validation\r\n    if (!this.selectedPlatform) {\r\n      this.errors.platform = app.translator.trans('wusong8899-tournament-widget.forum.participate_modal.platform_required');\r\n    }\r\n    \r\n    if (!this.platformUsername().trim()) {\r\n      this.errors.platformUsername = app.translator.trans('wusong8899-tournament-widget.forum.participate_modal.username_required');\r\n    }\r\n    \r\n    // If there are validation errors, don't submit\r\n    if (Object.keys(this.errors).length > 0) {\r\n      m.redraw();\r\n      return;\r\n    }\r\n\r\n    this.loading = true;\r\n\r\n    app.request({\r\n      method: 'POST',\r\n      url: app.forum.attribute('apiUrl') + '/tournament/participate',\r\n      body: {\r\n        data: {\r\n          attributes: {\r\n            platformId: this.selectedPlatform.id,\r\n            platformUsername: this.platformUsername().trim(),\r\n            winLossAmount: this.winLossAmount(),\r\n            // Keep legacy field for backward compatibility\r\n            platformAccount: this.platformUsername().trim()\r\n          }\r\n        }\r\n      }\r\n    }).then(\r\n      () => {\r\n        this.loading = false;\r\n        app.modal.close();\r\n        app.alerts.show({ type: 'success' }, app.translator.trans('wusong8899-tournament-widget.forum.participate_modal.success'));\r\n        // Trigger a refresh of the tournament widget\r\n        this.attrs.onParticipate?.();\r\n      },\r\n      (error) => {\r\n        this.loading = false;\r\n        this.handleError(error);\r\n        m.redraw();\r\n      }\r\n    );\r\n  }\r\n\r\n  private loadPlatforms() {\r\n    app.request({\r\n      method: 'GET',\r\n      url: app.forum.attribute('apiUrl') + '/tournament/platforms'\r\n    }).then(\r\n      (response: any) => {\r\n        this.platforms = response.data.map((platform: any) => ({\r\n          id: platform.id,\r\n          name: platform.attributes.name,\r\n          iconUrl: platform.attributes.iconUrl,\r\n          iconClass: platform.attributes.iconClass,\r\n          isActive: platform.attributes.isActive,\r\n          displayOrder: platform.attributes.displayOrder\r\n        }));\r\n        this.loadingPlatforms = false;\r\n        m.redraw();\r\n      },\r\n      (error) => {\r\n        console.error('Failed to load platforms:', error);\r\n        this.loadingPlatforms = false;\r\n        app.alerts.show({ type: 'error' }, '加载平台信息失败');\r\n        m.redraw();\r\n      }\r\n    );\r\n  }\r\n\r\n  private onPlatformSelect(platform: TournamentPlatform) {\r\n    this.selectedPlatform = platform;\r\n    // Clear username when switching platforms\r\n    this.platformUsername('');\r\n    // Clear platform related errors\r\n    delete this.errors.platform;\r\n    delete this.errors.platformId;\r\n  }\r\n\r\n  private handleError(error: any) {\r\n    // Clear previous errors\r\n    this.errors = {};\r\n    \r\n    if (error?.response?.errors) {\r\n      // Handle JSON:API validation errors\r\n      const errors = error.response.errors;\r\n      errors.forEach((err: any) => {\r\n        if (err.source?.pointer) {\r\n          const field = err.source.pointer.replace('/data/attributes/', '');\r\n          this.errors[field] = err.detail || err.title;\r\n        } else {\r\n          // If error doesn't have a specific field, show as general message\r\n          app.alerts.show({ type: 'error' }, err.detail || err.title || app.translator.trans('wusong8899-tournament-widget.forum.participate_modal.error'));\r\n        }\r\n      });\r\n    } else if (error?.response?.data?.errors) {\r\n      // Handle Laravel validation errors\r\n      const errors = error.response.data.errors;\r\n      Object.keys(errors).forEach(field => {\r\n        this.errors[field] = errors[field][0]; // Take first error message\r\n      });\r\n    } else {\r\n      // Generic error handling\r\n      const errorMessage = error?.response?.data?.message || \r\n                          error?.message || \r\n                          app.translator.trans('wusong8899-tournament-widget.forum.participate_modal.error');\r\n      app.alerts.show({ type: 'error' }, errorMessage);\r\n    }\r\n  }\r\n}","// Tournament Widget Color Constants\r\n// These match the LESS variables in less/variables.less\r\n\r\nexport const TOURNAMENT_COLORS = {\r\n  // Primary gradient (matches @tournament-primary-gradient)\r\n  PRIMARY_GRADIENT: 'linear-gradient(75.2deg, #2129a7 0.57%, #132cd1 72.59%)',\r\n  \r\n  // Individual primary colors\r\n  PRIMARY_START: '#2129a7',\r\n  PRIMARY_END: '#132cd1',\r\n  \r\n  // Gold colors\r\n  GOLD: '#ffd700',\r\n  GOLD_DARK: '#e9b424',\r\n  \r\n  // Status colors\r\n  SUCCESS: '#28a745',\r\n  SUCCESS_LIGHT: '#4caf50',\r\n  SUCCESS_BORDER: '#1e7e34',\r\n  ERROR: '#dc3545',\r\n  ERROR_ALT: '#ff4444',\r\n  ERROR_BORDER: '#c82333',\r\n  \r\n  // Ranking colors\r\n  RANK_GOLD: '#ffd700',\r\n  RANK_SILVER: '#c0c0c0',\r\n  RANK_BRONZE: '#cd7f32',\r\n  \r\n  // Neutral colors\r\n  WHITE: '#ffffff',\r\n  BLACK: '#000000',\r\n  GRAY: '#888888',\r\n  GRAY_DARK: '#333333',\r\n  \r\n  // Background colors\r\n  MODAL_BG: '#2a2a3e',\r\n  CONTROL_BG: '#f8f9fa',\r\n  BORDER: '#ddd',\r\n  PLATFORM_COLOR: '#00bcd4',\r\n} as const;\r\n\r\n// Helper function to create background style with image and gradient\r\nexport function createTournamentBackground(imageUrl?: string): string {\r\n  if (imageUrl) {\r\n    return `url(${imageUrl}) center/cover no-repeat, ${TOURNAMENT_COLORS.PRIMARY_GRADIENT}`;\r\n  }\r\n  return TOURNAMENT_COLORS.PRIMARY_GRADIENT;\r\n}","import app from 'flarum/forum/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport ParticipateModal from './ParticipateModal';\r\nimport { createTournamentBackground } from '../../common/colors';\r\nimport { Vnode } from 'mithril';\r\n\r\ninterface TournamentCardAttrs {\r\n  title: string;\r\n  prizePool: string;\r\n  detailsUrl: string;\r\n  backgroundImage: string;\r\n  timeElapsed: {\r\n    days: string;\r\n    hours: string;\r\n    mins: string;\r\n    secs: string;\r\n  };\r\n  userParticipated: boolean;\r\n  userApplicationStatus: {\r\n    isApproved: boolean;\r\n    submittedAt?: string;\r\n    approvedAt?: string;\r\n  } | null;\r\n  onParticipate: () => void;\r\n}\r\n\r\nexport default class TournamentCard extends Component<TournamentCardAttrs> {\r\n  view(vnode: Vnode<TournamentCardAttrs>) {\r\n    const { title, prizePool, detailsUrl, backgroundImage, timeElapsed, userParticipated, userApplicationStatus, onParticipate } = vnode.attrs;\r\n\r\n    return (\r\n      <div className=\"TournamentCard\" style={{ background: createTournamentBackground(backgroundImage) }}>\r\n        <div className=\"TournamentCard-header\">\r\n          {title && <div className=\"TournamentCard-title\">{title}</div>}\r\n          <a className=\"TournamentCard-detailsLink\" href={detailsUrl} target=\"_blank\" rel=\"noopener noreferrer\">\r\n            {app.translator.trans('wusong8899-tournament-widget.forum.tournament.details')}\r\n          </a>\r\n          <div className=\"TournamentCard-prizePool\">\r\n            <label>{app.translator.trans('wusong8899-tournament-widget.forum.tournament.prize_pool')}</label>\r\n            <span>{prizePool}</span>\r\n          </div>\r\n        </div>\r\n        <div className=\"TournamentCard-content\">\r\n          <div className=\"TournamentCard-contentRow\">\r\n            <div className=\"Timer\">\r\n              <label>{app.translator.trans('wusong8899-tournament-widget.forum.tournament.started_at')}</label>\r\n              <div className=\"Timer-display\">\r\n                <div className=\"Timer-boxes\">\r\n                  <div className=\"Timer-unit\">\r\n                    <strong>{timeElapsed.days}</strong>\r\n                  </div>\r\n                  <span className=\"Timer-separator\">:</span>\r\n                  <div className=\"Timer-unit\">\r\n                    <strong>{timeElapsed.hours}</strong>\r\n                  </div>\r\n                  <span className=\"Timer-separator\">:</span>\r\n                  <div className=\"Timer-unit\">\r\n                    <strong>{timeElapsed.mins}</strong>\r\n                  </div>\r\n                  <span className=\"Timer-separator\">:</span>\r\n                  <div className=\"Timer-unit\">\r\n                    <strong>{timeElapsed.secs}</strong>\r\n                  </div>\r\n                </div>\r\n                <div className=\"Timer-labels\">\r\n                  <div className=\"Timer-label\">DAYS</div>\r\n                  <span className=\"Timer-spacer\"></span>\r\n                  <div className=\"Timer-label\">HRS</div>\r\n                  <span className=\"Timer-spacer\"></span>\r\n                  <div className=\"Timer-label\">MINS</div>\r\n                  <span className=\"Timer-spacer\"></span>\r\n                  <div className=\"Timer-label\">SECS</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"TournamentCard-actions\">\r\n              {!userParticipated && app.session.user && (\r\n                <Button \r\n                  className=\"Button Button--primary TournamentCard-participateBtn\"\r\n                  onclick={() => {\r\n                    app.modal.show(ParticipateModal, {\r\n                      onParticipate: onParticipate\r\n                    });\r\n                  }}\r\n                >\r\n                  {app.translator.trans('wusong8899-tournament-widget.forum.tournament.participate_now')}\r\n                </Button>\r\n              )}\r\n              {userParticipated && userApplicationStatus && (\r\n                <div className={`TournamentCard-status ${userApplicationStatus.isApproved ? 'approved' : 'pending'}`}>\r\n                  {userApplicationStatus.isApproved ? (\r\n                    <>\r\n                      <i className=\"fas fa-check-circle\"></i> \r\n                      {app.translator.trans('wusong8899-tournament-widget.forum.tournament.approved')}\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <i className=\"fas fa-clock\"></i> \r\n                      {app.translator.trans('wusong8899-tournament-widget.forum.tournament.pending_approval')}\r\n                    </>\r\n                  )}\r\n                </div>\r\n              )}\r\n              {!app.session.user && (\r\n                <Button \r\n                  className=\"Button Button--primary TournamentCard-participateBtn\"\r\n                  onclick={() => app.route('login')}\r\n                >\r\n                  {app.translator.trans('wusong8899-tournament-widget.forum.tournament.login_to_participate')}\r\n                </Button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}","import app from 'flarum/forum/app';\r\nimport Modal from 'flarum/common/components/Modal';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Button from 'flarum/common/components/Button';\r\nimport avatar from 'flarum/common/helpers/avatar';\r\nimport User from 'flarum/common/models/User';\r\nimport type Mithril from 'mithril';\r\nimport m from 'mithril';\r\n\r\ninterface IParticipant {\r\n  id: string;\r\n  rank: number;\r\n  title: string;\r\n  amount: number;\r\n  score: number;\r\n  createdAt: string;\r\n  user: {\r\n    id: string;\r\n    username: string;\r\n    displayName: string;\r\n    avatarUrl: string;\r\n  };\r\n  platform: {\r\n    id: number | null;\r\n    name: string;\r\n    username: string;\r\n    iconUrl: string | null;\r\n    iconClass: string | null;\r\n    usesUrlIcon: boolean;\r\n    usesCssIcon: boolean;\r\n  };\r\n  platformAccount: string;\r\n}\r\n\r\ninterface ITournamentData {\r\n  title: string;\r\n  prizePool: string;\r\n  startDate: string;\r\n  detailsUrl: string;\r\n  backgroundImage: string;\r\n  headerTitle: string;\r\n  headerImage: string;\r\n  participants: IParticipant[];\r\n}\r\n\r\nexport default class TournamentRankingsModal extends Modal {\r\n  private loading = true;\r\n  private tournamentData: ITournamentData | null = null;\r\n  private error: string | null = null;\r\n\r\n  oninit(vnode: Mithril.Vnode) {\r\n    super.oninit(vnode);\r\n    this.loadTournamentData();\r\n  }\r\n\r\n  className() {\r\n    return 'TournamentRankingsModal Modal--large';\r\n  }\r\n\r\n  title() {\r\n    return this.tournamentData?.headerTitle ;\r\n  }\r\n\r\n  private async loadTournamentData(): Promise<void> {\r\n    try {\r\n      this.loading = true;\r\n      m.redraw();\r\n\r\n      const response = await app.request({\r\n        method: 'GET',\r\n        url: `${app.forum.attribute('apiUrl')}/tournament`,\r\n      });\r\n\r\n      if (response && response.data && response.data.attributes) {\r\n        this.tournamentData = response.data.attributes;\r\n        this.error = null;\r\n      } else {\r\n        throw new Error('Invalid response format');\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load tournament data:', error);\r\n      this.error = 'Failed to load tournament data';\r\n    } finally {\r\n      this.loading = false;\r\n      m.redraw();\r\n    }\r\n  }\r\n\r\n  content() {\r\n    try {\r\n      return this.renderContent();\r\n    } catch (error) {\r\n      console.error('TournamentRankingsModal content error:', error);\r\n      return (\r\n        <div className=\"TournamentRankingsModal-error\">\r\n          <h3>Error loading tournament rankings</h3>\r\n          <p>Please try again or contact support.</p>\r\n          <Button className=\"Button Button--primary\" onclick={() => this.hide()}>\r\n            关闭\r\n          </Button>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  private renderContent() {\r\n    if (this.loading) {\r\n      return <LoadingIndicator />;\r\n    }\r\n\r\n    if (this.error || !this.tournamentData) {\r\n      return (\r\n        <div className=\"TournamentRankingsModal-error\">\r\n          <h3>{app.translator.trans('core.forum.error.generic_message')}</h3>\r\n          <p>{this.error || 'Tournament data not available'}</p>\r\n          <Button className=\"Button Button--primary\" onclick={() => this.hide()}>\r\n            关闭\r\n          </Button>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    const { tournamentData } = this;\r\n\r\n    return (\r\n      <div className=\"TournamentRankingsModal-content\">\r\n        <div className=\"TournamentRankingsModal-header\">\r\n          <div className=\"TournamentRankingsModal-tournamentInfo\">\r\n            <h3>{tournamentData.title}</h3>\r\n            <p className=\"TournamentRankingsModal-prizePool\">\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.tournament.prize_pool')}: {tournamentData.prizePool}\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"TournamentRankingsModal-leaderboard\">\r\n          {this.renderFullLeaderboard()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderFullLeaderboard() {\r\n    if (!this.tournamentData || !this.tournamentData.participants.length) {\r\n      return (\r\n        <div className=\"TournamentRankingsModal-empty\">\r\n          {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.no_participants')}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"Leaderboard Leaderboard--modal\">\r\n        <div className=\"Leaderboard-header\">\r\n          <div className=\"Leaderboard-headerRow\">\r\n            <div className=\"Leaderboard-headerCell rank\">\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.rank')}\r\n            </div>\r\n            <div className=\"Leaderboard-headerCell user\">\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.user')}\r\n            </div>\r\n            <div className=\"Leaderboard-headerCell platform\">\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.platform')}\r\n            </div>\r\n            <div className=\"Leaderboard-headerCell score\">\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.amount')}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"Leaderboard-list\">\r\n          {this.tournamentData.participants.map((participant) => (\r\n            <div \r\n              className={`Leaderboard-item rank-${participant.rank}`} \r\n              key={participant.id}\r\n              data-rank={`#${participant.rank}`}\r\n              title={`${participant.user.displayName} - ${participant.title}`}\r\n            >\r\n              <div className=\"Leaderboard-cell rank\">\r\n                <i className={this.getRankIcon(participant.rank)}></i>\r\n                <span className=\"rank-number\">{participant.rank}</span>\r\n              </div>\r\n              <div className=\"Leaderboard-cell user\">\r\n                <div className=\"user-info\">\r\n                  {this.renderUserAvatar(participant.user)}\r\n                  <div className=\"user-details\">\r\n                    <span className=\"user-name\">{participant.user.displayName}</span>\r\n                    <span className=\"user-title\">{participant.title}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"Leaderboard-cell platform\">\r\n                <div className=\"platform-info\">\r\n                  {this.renderPlatformIcon(participant.platform)}\r\n                  <div className=\"platform-details\">\r\n                    <div className=\"platform-name\">{participant.platform.name}</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"Leaderboard-cell score\">\r\n                <span className={`score-amount ${\r\n                  participant.amount < 0 ? 'negative' : \r\n                  participant.amount > 0 ? 'positive' : 'zero'\r\n                }`}>\r\n                  {participant.amount}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private getRankIcon(rank: number): string {\r\n    if (rank === 1) return 'fas fa-crown rank-gold';\r\n    if (rank === 2) return 'fas fa-crown rank-silver';\r\n    if (rank === 3) return 'fas fa-crown rank-bronze';\r\n    return 'fas fa-medal';\r\n  }\r\n\r\n  private renderUserAvatar(userData: IParticipant['user']) {\r\n    const user = app.store.getById<User>('users', userData.id);\r\n    \r\n    if (user) {\r\n      return avatar(user, { className: 'user-avatar' });\r\n    } else {\r\n      return userData.avatarUrl ? (\r\n        <img \r\n          className=\"user-avatar\" \r\n          src={userData.avatarUrl} \r\n          alt={userData.displayName}\r\n        />\r\n      ) : (\r\n        <div className=\"user-avatar user-avatar--default\">\r\n          <i className=\"fas fa-user\"></i>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  private renderPlatformIcon(platform: IParticipant['platform']) {\r\n    if (platform.usesUrlIcon && platform.iconUrl) {\r\n      return (\r\n        <img \r\n          className=\"platform-icon image-icon\" \r\n          src={platform.iconUrl} \r\n          alt={platform.name}\r\n        />\r\n      );\r\n    } else if (platform.usesCssIcon && platform.iconClass) {\r\n      return <i className={`platform-icon css-icon ${platform.iconClass}`}></i>;\r\n    } else {\r\n      return <i className=\"platform-icon css-icon fas fa-gamepad\"></i>;\r\n    }\r\n  }\r\n}","import app from 'flarum/forum/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Button from 'flarum/common/components/Button';\r\nimport avatar from 'flarum/common/helpers/avatar';\r\nimport User from 'flarum/common/models/User';\r\nimport TournamentRankingsModal from './TournamentRankingsModal';\r\nimport { Vnode, VnodeDOM } from 'mithril';\r\n\r\ninterface IParticipant {\r\n  id: string;\r\n  rank: number;\r\n  title: string;\r\n  amount: number;\r\n  score: number;\r\n  createdAt: string;\r\n  user: {\r\n    id: string;\r\n    username: string;\r\n    displayName: string;\r\n    avatarUrl: string;\r\n  };\r\n  platform: {\r\n    id: number | null;\r\n    name: string;\r\n    username: string;\r\n    iconUrl: string | null;\r\n    iconClass: string | null;\r\n    usesUrlIcon: boolean;\r\n    usesCssIcon: boolean;\r\n  };\r\n  platformAccount: string; // Legacy field for backward compatibility\r\n}\r\n\r\ninterface LeaderboardAttrs {\r\n  participants: IParticipant[];\r\n}\r\n\r\nexport default class Leaderboard extends Component<LeaderboardAttrs> {\r\n  containerRef: HTMLElement | null = null;\r\n\r\n  oncreate(vnode: VnodeDOM<LeaderboardAttrs>) {\r\n    super.oncreate(vnode);\r\n    this.containerRef = vnode.dom as HTMLElement;\r\n    this.observeResize();\r\n  }\r\n\r\n  onremove() {\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.disconnect();\r\n    }\r\n  }\r\n\r\n  private resizeObserver?: ResizeObserver;\r\n\r\n  observeResize() {\r\n    if (!this.containerRef || typeof ResizeObserver === 'undefined') return;\r\n    \r\n    this.resizeObserver = new ResizeObserver(entries => {\r\n      for (let entry of entries) {\r\n        const width = entry.contentRect.width;\r\n        // Add classes based on container width for additional responsive control\r\n        if (width < 640) {\r\n          this.containerRef?.classList.add('compact-view');\r\n          this.containerRef?.classList.remove('wide-view');\r\n        } else if (width > 1200) {\r\n          this.containerRef?.classList.add('wide-view');\r\n          this.containerRef?.classList.remove('compact-view');\r\n        } else {\r\n          this.containerRef?.classList.remove('compact-view', 'wide-view');\r\n        }\r\n      }\r\n    });\r\n    \r\n    this.resizeObserver.observe(this.containerRef);\r\n  }\r\n\r\n  view(vnode: Vnode<LeaderboardAttrs>) {\r\n    const { participants } = vnode.attrs;\r\n    \r\n    // Get preview limit from settings (default to 5)\r\n    const previewLimitSetting = app.forum.attribute('wusong8899_tournament.preview_limit');\r\n    const previewLimit = previewLimitSetting ? parseInt(previewLimitSetting) : 5;\r\n    \r\n    const rankingsToShow = participants.slice(0, previewLimit);\r\n\r\n    return (\r\n      <div className=\"Leaderboard\">\r\n        <div className=\"Leaderboard-header\">\r\n          <div className=\"Leaderboard-headerRow\">\r\n            <div className=\"Leaderboard-headerCell rank\">\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.rank')}\r\n            </div>\r\n            <div className=\"Leaderboard-headerCell user\">\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.user')}\r\n            </div>\r\n            <div className=\"Leaderboard-headerCell platform\">\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.platform')}\r\n            </div>\r\n            <div className=\"Leaderboard-headerCell score\">\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.amount')}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"Leaderboard-list\">\r\n          {rankingsToShow.length > 0 ? (\r\n            rankingsToShow.map((participant) => (\r\n              <div \r\n                className={`Leaderboard-item rank-${participant.rank}`} \r\n                key={participant.id}\r\n                data-rank={`#${participant.rank}`}\r\n                title={`${participant.user.displayName} - ${participant.title}`}>\r\n                <div className=\"Leaderboard-cell rank\">\r\n                  <i className={this.getRankIcon(participant.rank)}></i>\r\n                  <span className=\"rank-number\">{participant.rank}</span>\r\n                </div>\r\n                <div className=\"Leaderboard-cell user\">\r\n                  <div className=\"user-info\">\r\n                    {this.renderUserAvatar(participant.user)}\r\n                    <div className=\"user-details\">\r\n                      <span className=\"user-name\">{participant.user.displayName}</span>\r\n                      <span className=\"user-title\">{participant.title}</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"Leaderboard-cell platform\">\r\n                  <div className=\"platform-info\">\r\n                    {this.renderPlatformIcon(participant.platform)}\r\n                    <div className=\"platform-details\">\r\n                      <div className=\"platform-name\">{participant.platform.name}</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"Leaderboard-cell score\">\r\n                  <span className={`score-amount ${\r\n                    participant.amount < 0 ? 'negative' : \r\n                    participant.amount > 0 ? 'positive' : 'zero'\r\n                  }`}>\r\n                    {participant.amount}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            ))\r\n          ) : (\r\n            <div className=\"Leaderboard-empty\">\r\n              {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.no_participants')}\r\n            </div>\r\n          )}\r\n        </div>\r\n        {participants.length > previewLimit && (\r\n          <Button \r\n            className=\"Button Button--block Leaderboard-detailsBtn\"\r\n            onclick={(e: Event) => { \r\n              e.preventDefault();\r\n              e.stopPropagation();\r\n              \r\n              try {\r\n                app.modal.show(TournamentRankingsModal);\r\n              } catch (error) {\r\n                console.error('Modal show error:', error);\r\n                // Fallback to alert for user feedback\r\n                app.alerts.show({ type: 'error' }, '无法打开完整排行榜');\r\n              }\r\n            }}\r\n          >\r\n            {app.translator.trans('wusong8899-tournament-widget.forum.leaderboard.view_details')}\r\n          </Button>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  getRankIcon(rank: number): string {\r\n    if (rank === 1) return 'fas fa-crown rank-gold';\r\n    if (rank === 2) return 'fas fa-crown rank-silver';\r\n    if (rank === 3) return 'fas fa-crown rank-bronze';\r\n    return 'fas fa-medal';\r\n  }\r\n\r\n  renderUserAvatar(userData: IParticipant['user']) {\r\n    // Try to get the User model from the store\r\n    const user = app.store.getById<User>('users', userData.id);\r\n    \r\n    if (user) {\r\n      // Use Flarum's avatar helper with the proper User model\r\n      return avatar(user, { className: 'user-avatar' });\r\n    } else {\r\n      // Fallback to manual avatar rendering\r\n      return userData.avatarUrl ? (\r\n        <img \r\n          className=\"user-avatar\" \r\n          src={userData.avatarUrl} \r\n          alt={userData.displayName}\r\n        />\r\n      ) : (\r\n        <div className=\"user-avatar user-avatar--default\">\r\n          <i className=\"fas fa-user\"></i>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  renderPlatformIcon(platform: IParticipant['platform']) {\r\n    if (platform.usesUrlIcon && platform.iconUrl) {\r\n      return (\r\n        <img \r\n          className=\"platform-icon image-icon\" \r\n          src={platform.iconUrl} \r\n          alt={platform.name}\r\n        />\r\n      );\r\n    } else if (platform.usesCssIcon && platform.iconClass) {\r\n      return <i className={`platform-icon css-icon ${platform.iconClass}`}></i>;\r\n    } else {\r\n      // Default platform icon\r\n      return <i className=\"platform-icon css-icon fas fa-gamepad\"></i>;\r\n    }\r\n  }\r\n}","import app from 'flarum/forum/app';\r\nimport Component from 'flarum/common/Component';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport m from 'mithril';\r\nimport TournamentCard from './TournamentCard';\r\nimport Leaderboard from './Leaderboard';\r\nimport { Vnode } from 'mithril';\r\n\r\ninterface IParticipant {\r\n  id: string;\r\n  rank: number;\r\n  title: string;\r\n  amount: number;\r\n  score: number;\r\n  createdAt: string;\r\n  user: {\r\n    id: string;\r\n    username: string;\r\n    displayName: string;\r\n    avatarUrl: string;\r\n  };\r\n  platform: {\r\n    id: number | null;\r\n    name: string;\r\n    username: string;\r\n    iconUrl: string | null;\r\n    iconClass: string | null;\r\n    usesUrlIcon: boolean;\r\n    usesCssIcon: boolean;\r\n  };\r\n  platformAccount: string; // Legacy field for backward compatibility\r\n}\r\n\r\ninterface ITournamentData {\r\n  title: string;\r\n  prizePool: string;\r\n  startDate: string;\r\n  detailsUrl: string;\r\n  backgroundImage: string;\r\n  headerTitle: string;\r\n  headerImage: string;\r\n  userParticipated: boolean;\r\n  userApplicationStatus: {\r\n    isApproved: boolean;\r\n    submittedAt?: string;\r\n    approvedAt?: string;\r\n  } | null;\r\n  totalParticipants: number;\r\n  participants: IParticipant[];\r\n}\r\n\r\nfunction formatDuration(ms: number) {\r\n  const s = Math.floor(ms / 1000);\r\n  const m = Math.floor(s / 60);\r\n  const h = Math.floor(m / 60);\r\n  const d = Math.floor(h / 24);\r\n  return {\r\n    days: String(d).padStart(2, '0'),\r\n    hours: String(h % 24).padStart(2, '0'),\r\n    mins: String(m % 60).padStart(2, '0'),\r\n    secs: String(s % 60).padStart(2, '0'),\r\n  };\r\n}\r\n\r\nexport default class TournamentWidget extends Component {\r\n  loading: boolean = true;\r\n  tournamentData: ITournamentData | null = null;\r\n  timerInterval: number | null = null;\r\n  animationFrame: number | null = null;\r\n  timeElapsed = { days: '00', hours: '00', mins: '00', secs: '00' };\r\n  lastUpdateTime: number = 0;\r\n  isRedrawing: boolean = false;\r\n  loadingStartTime: number = 0;\r\n  loadingTimeout: number | null = null;\r\n\r\n  oninit(vnode: Vnode) {\r\n    super.oninit(vnode);\r\n    this.loadData();\r\n  }\r\n\r\n  oncreate(vnode: Vnode) {\r\n    super.oncreate(vnode);\r\n    // Note: Timer will be started after data is loaded in loadData()\r\n  }\r\n\r\n  onremove(vnode: Vnode) {\r\n    super.onremove(vnode);\r\n    \r\n    // Clear timer and animation frame\r\n    if (this.timerInterval) {\r\n      clearInterval(this.timerInterval);\r\n      this.timerInterval = null;\r\n    }\r\n    if (this.animationFrame) {\r\n      cancelAnimationFrame(this.animationFrame);\r\n      this.animationFrame = null;\r\n    }\r\n    \r\n    // Clear loading timeout\r\n    if (this.loadingTimeout) {\r\n      clearTimeout(this.loadingTimeout);\r\n      this.loadingTimeout = null;\r\n    }\r\n    \r\n    // Clear tournament data to prevent timer from continuing\r\n    this.tournamentData = null;\r\n    this.isRedrawing = false;\r\n  }\r\n\r\n  view() {\r\n    try {\r\n      if (this.loading) {\r\n        return (\r\n          <div className=\"TournamentWidget\">\r\n            <div className=\"TournamentWidget-loading\">\r\n              <LoadingIndicator />\r\n            </div>\r\n          </div>\r\n        );\r\n      }\r\n\r\n      if (!this.tournamentData) {\r\n        return null;\r\n      }\r\n\r\n      return (\r\n        <div className=\"TournamentWidget\">\r\n          <div className=\"TournamentHeader\">\r\n            {this.tournamentData.headerImage && (\r\n              <img \r\n                className=\"TournamentHeader-image\" \r\n                src={this.tournamentData.headerImage}\r\n                alt=\"Tournament\"\r\n              />\r\n            )}\r\n            <span className=\"TournamentHeader-title\">{this.tournamentData.headerTitle}</span>\r\n          </div>\r\n          <TournamentCard\r\n            title={this.tournamentData.title}\r\n            prizePool={this.tournamentData.prizePool}\r\n            detailsUrl={this.tournamentData.detailsUrl}\r\n            backgroundImage={this.tournamentData.backgroundImage}\r\n            timeElapsed={this.timeElapsed}\r\n            userParticipated={this.tournamentData.userParticipated}\r\n            userApplicationStatus={this.tournamentData.userApplicationStatus}\r\n            onParticipate={() => this.loadData()}\r\n          />\r\n          <Leaderboard \r\n            participants={this.tournamentData.participants}\r\n          />\r\n        </div>\r\n      );\r\n    } catch (error) {\r\n      console.error('TournamentWidget view error:', error);\r\n      return (\r\n        <div className=\"TournamentWidget TournamentWidget--error\">\r\n          <div className=\"TournamentWidget-error\">\r\n            <p>Tournament widget encountered an error. Please refresh the page.</p>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  startTimer() {\r\n    if (!this.tournamentData?.startDate) {\r\n      console.warn('TournamentWidget: Cannot start timer - no tournament data or start date');\r\n      return;\r\n    }\r\n    \r\n    // Validate startDate\r\n    const startDate = new Date(this.tournamentData.startDate);\r\n    if (isNaN(startDate.getTime())) {\r\n      console.error('TournamentWidget: Invalid start date:', this.tournamentData.startDate);\r\n      return;\r\n    }\r\n    \r\n    console.log('TournamentWidget: Starting timer with start date:', startDate);\r\n    this.lastUpdateTime = Date.now();\r\n    \r\n    const updateTimer = () => {\r\n      // Check if component is still valid and not already redrawing\r\n      if (this.isRedrawing || !this.tournamentData) {\r\n        return;\r\n      }\r\n      \r\n      const now = Date.now();\r\n      // Only update every second, not on every frame\r\n      if (now - this.lastUpdateTime >= 1000) {\r\n        const diff = now - startDate.getTime();\r\n        if (diff > 0) {\r\n          this.timeElapsed = formatDuration(diff);\r\n          this.lastUpdateTime = now;\r\n          \r\n          // Prevent recursive redraws\r\n          this.isRedrawing = true;\r\n          try {\r\n            m.redraw();\r\n          } catch (error) {\r\n            console.error('Tournament timer redraw error:', error);\r\n          } finally {\r\n            // Reset flag after a small delay to allow redraw to complete\r\n            setTimeout(() => {\r\n              this.isRedrawing = false;\r\n            }, 10);\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Only continue animation if component is still mounted\r\n      if (this.tournamentData && !this.isRedrawing) {\r\n        this.animationFrame = requestAnimationFrame(updateTimer);\r\n      }\r\n    };\r\n    \r\n    this.animationFrame = requestAnimationFrame(updateTimer);\r\n  }\r\n\r\n  loadData() {\r\n    // Prevent multiple simultaneous loads, but allow retry after timeout\r\n    if (this.loading) {\r\n      const now = Date.now();\r\n      const timeSinceLoadingStart = now - this.loadingStartTime;\r\n      // Allow retry if loading has been stuck for more than 10 seconds\r\n      if (timeSinceLoadingStart < 10000) {\r\n        console.log('TournamentWidget: Load already in progress, skipping');\r\n        return Promise.resolve();\r\n      } else {\r\n        console.warn('TournamentWidget: Loading timeout reached, forcing retry');\r\n        this.resetLoadingState();\r\n      }\r\n    }\r\n    \r\n    this.loading = true;\r\n    this.loadingStartTime = Date.now();\r\n    \r\n    // Set a timeout to prevent infinite loading\r\n    this.loadingTimeout = window.setTimeout(() => {\r\n      if (this.loading) {\r\n        console.error('TournamentWidget: Loading timeout exceeded, resetting state');\r\n        this.resetLoadingState();\r\n        try {\r\n          m.redraw();\r\n        } catch (error) {\r\n          console.error('Failed to redraw after timeout reset:', error);\r\n        }\r\n      }\r\n    }, 15000); // 15 second timeout\r\n    \r\n    console.log('TournamentWidget: Starting data load request');\r\n    \r\n    return app.request({\r\n      method: 'GET',\r\n      url: app.forum.attribute('apiUrl') + '/tournament',\r\n    }).then((response: any) => {\r\n      console.log('TournamentWidget: Received response:', response);\r\n      \r\n      // Validate response structure\r\n      if (!response || !response.data || !response.data.attributes) {\r\n        console.error('TournamentWidget: Invalid response structure:', response);\r\n        throw new Error('Invalid tournament data response structure');\r\n      }\r\n      \r\n      const attrs = response.data.attributes;\r\n      console.log('TournamentWidget: Processing tournament data with', attrs.participants?.length || 0, 'participants');\r\n      \r\n      this.tournamentData = {\r\n        title: response.data.attributes.title || '',\r\n        prizePool: response.data.attributes.prizePool || '0',\r\n        startDate: response.data.attributes.startDate || new Date().toISOString(),\r\n        detailsUrl: response.data.attributes.detailsUrl || '',\r\n        backgroundImage: response.data.attributes.backgroundImage || '',\r\n        headerTitle: response.data.attributes.headerTitle || '',\r\n        headerImage: response.data.attributes.headerImage || '',\r\n        userParticipated: response.data.attributes.userParticipated || false,\r\n        userApplicationStatus: response.data.attributes.userApplicationStatus || null,\r\n        totalParticipants: response.data.attributes.totalParticipants || 0,\r\n        participants: response.data.attributes.participants || []\r\n      };\r\n      \r\n      // Clear loading timeout on success\r\n      if (this.loadingTimeout) {\r\n        clearTimeout(this.loadingTimeout);\r\n        this.loadingTimeout = null;\r\n      }\r\n      this.loading = false;\r\n      \r\n      console.log('TournamentWidget: Successfully loaded tournament data');\r\n      \r\n      // Start timer after data is loaded (only if not already running)\r\n      if (!this.animationFrame && this.tournamentData.startDate) {\r\n        console.log('TournamentWidget: Starting timer for tournament');\r\n        this.startTimer();\r\n      } else if (this.animationFrame) {\r\n        console.log('TournamentWidget: Timer already running, skipping start');\r\n      } else {\r\n        console.warn('TournamentWidget: No start date provided, timer not started');\r\n      }\r\n      \r\n      try {\r\n        m.redraw();\r\n      } catch (redrawError) {\r\n        console.error('Failed to redraw after loading data:', redrawError);\r\n      }\r\n    }).catch((error: any) => {\r\n      // Clear loading timeout on error\r\n      if (this.loadingTimeout) {\r\n        clearTimeout(this.loadingTimeout);\r\n        this.loadingTimeout = null;\r\n      }\r\n      this.loading = false;\r\n      \r\n      // Detailed error logging\r\n      if (error.response) {\r\n        console.error('TournamentWidget: Server error response:', error.response.status, error.response.data);\r\n      } else if (error.request) {\r\n        console.error('TournamentWidget: Network error - no response received:', error.request);\r\n      } else {\r\n        console.error('TournamentWidget: Request setup error:', error.message);\r\n      }\r\n      \r\n      console.warn('TournamentWidget: Setting fallback data to prevent complete failure');\r\n      \r\n      // Set fallback tournament data to prevent complete failure\r\n      this.tournamentData = {\r\n        title: 'Tournament',\r\n        prizePool: '0',\r\n        startDate: new Date().toISOString(),\r\n        detailsUrl: '',\r\n        backgroundImage: '',\r\n        headerTitle: 'Tournament',\r\n        headerImage: '',\r\n        userParticipated: false,\r\n        userApplicationStatus: null,\r\n        totalParticipants: 0,\r\n        participants: []\r\n      };\r\n      \r\n      try {\r\n        m.redraw();\r\n      } catch (redrawError) {\r\n        console.error('Failed to redraw after error:', redrawError);\r\n      }\r\n    });\r\n  }\r\n\r\n  private resetLoadingState() {\r\n    this.loading = false;\r\n    this.isRedrawing = false;\r\n    this.loadingStartTime = 0;\r\n    \r\n    if (this.loadingTimeout) {\r\n      clearTimeout(this.loadingTimeout);\r\n      this.loadingTimeout = null;\r\n    }\r\n    \r\n    console.log('TournamentWidget: Loading state reset');\r\n  }\r\n}","import app from 'flarum/forum/app';\r\nimport { extend } from 'flarum/common/extend';\r\nimport m from 'mithril';\r\nimport TournamentWidget from './components/TournamentWidget';\r\nimport TagsPage from 'flarum/tags/forum/components/TagsPage';\r\n\r\napp.initializers.add('wusong8899-tournament-widget', () => {\r\n\r\n  if (TagsPage) {\r\n    extend(TagsPage.prototype, 'content', function (vnode) {\r\n      const children = vnode.children;\r\n      if (!Array.isArray(children)) return;\r\n\r\n      // Always add tournament widget at the end of the content\r\n      children.push(m(TournamentWidget));\r\n    });\r\n  } else {\r\n    console.warn('TagsPage not found - tournament widget will not be injected');\r\n  }\r\n});"],"names":["PlatformIcon","attrs","platform","size","icon","className","PlatformSelector","Component","vnode","selectedPlatform","showDropdown","platforms","onPlatformSelect","ParticipateModal","Modal","Stream","app","m","value","numValue","Button","error","response","err","field","errors","errorMessage","TOURNAMENT_COLORS","createTournamentBackground","imageUrl","TournamentCard","title","prizePool","detailsUrl","backgroundImage","timeElapsed","userParticipated","userApplicationStatus","onParticipate","TournamentRankingsModal","LoadingIndicator","tournamentData","participant","rank","userData","user","avatar","Leaderboard","entries","entry","width","participants","previewLimitSetting","previewLimit","rankingsToShow","e","formatDuration","ms","s","h","d","TournamentWidget","startDate","updateTimer","now","diff","redrawError","TagsPage","extend","children"],"mappings":"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"}