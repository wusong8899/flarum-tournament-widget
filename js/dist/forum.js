(function(r,k,t,c,v,d,w,g,h,N,T,y,o){"use strict";class b{view({attrs:e}){const{platform:a,size:s="medium"}=e;if(!a)return h("fas fa-gamepad",{className:`PlatformIcon PlatformIcon--${s}`});const l=`PlatformIcon PlatformIcon--${s}`;return a.iconUrl?m("img",{src:a.iconUrl,alt:a.name,className:l}):a.iconClass?h(a.iconClass,{className:l}):h("fas fa-gamepad",{className:l})}}class S extends c{oninit(e){super.oninit(e),this.state={showDropdown:!1}}view(){const{selectedPlatform:e}=this.attrs,{showDropdown:a}=this.state;return m("div",{className:"TournamentPlatformSelector"},m("div",{className:"TournamentPlatformSelector-label"},"游戏平台"),m("div",{className:"TournamentPlatformSelector-dropdown",onclick:()=>this.toggleDropdown()},m("div",{className:"TournamentPlatformSelector-selected"},m("div",{className:"TournamentPlatformSelector-info"},m("div",{className:"TournamentPlatformSelector-icon"},m(b,{platform:e,size:"medium"})),m("div",{className:"TournamentPlatformSelector-details"},m("div",{className:"TournamentPlatformSelector-name"},this.getPlatformName(e))))),h("fas fa-chevron-down",{className:"TournamentPlatformSelector-dropdownIcon"})),a&&this.renderPlatformDropdown())}toggleDropdown(){this.state.showDropdown=!this.state.showDropdown}getPlatformName(e){return e&&e.name||"请选择游戏平台"}renderPlatformDropdown(){const{platforms:e}=this.attrs;return!e||e.length===0?m("div",{className:"TournamentPlatformSelector-dropdownMenu"},m("div",{className:"TournamentPlatformSelector-dropdownItem TournamentPlatformSelector-noData"},"暂无可选平台")):m("div",{className:"TournamentPlatformSelector-dropdownMenu"},e.map(a=>m("div",{key:a.id,className:"TournamentPlatformSelector-dropdownItem",onclick:()=>this.selectPlatform(a)},m("div",{className:"TournamentPlatformSelector-icon"},m(b,{platform:a,size:"small"})),m("div",{className:"TournamentPlatformSelector-name"},a.name))))}selectPlatform(e){const{onPlatformSelect:a}=this.attrs;a(e),this.state.showDropdown=!1}}class L extends w{constructor(){super(...arguments),this.platformAccount="",this.platformUsername=g(""),this.winLossAmount=g(0),this.winLossAmountText=g("0"),this.selectedPlatform=null,this.platforms=[],this.loading=!1,this.loadingPlatforms=!0,this.errors={}}oninit(e){super.oninit(e),this.loadPlatforms()}className(){return"ParticipateModal Modal--small"}title(){return r.translator.trans("wusong8899-tournament-widget.forum.participate_modal.title")}content(){return this.loadingPlatforms?t("div",{className:"Modal-body"},t("div",{className:"LoadingIndicator"}),t("p",null,"加载平台信息中...")):t("div",{className:"Modal-body"},t("div",{className:"Form"},t("div",{className:"Form-group"},t(S,{platforms:this.platforms,selectedPlatform:this.selectedPlatform,onPlatformSelect:e=>this.onPlatformSelect(e)}),this.errors.platform&&t("div",{className:"Alert Alert--error",style:{marginTop:"8px"}},this.errors.platform),this.errors.platformId&&t("div",{className:"Alert Alert--error",style:{marginTop:"8px"}},this.errors.platformId)),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},"平台用户名"),t("input",{className:this.errors.platformUsername?"FormControl FormControl--error":"FormControl",type:"text",placeholder:"请输入您在该平台的用户名（支持中文、英文、数字等任意字符）",bidi:this.platformUsername,oninput:()=>{this.errors.platformUsername&&(delete this.errors.platformUsername,t.redraw())}}),this.errors.platformUsername&&t("div",{className:"Alert Alert--error",style:{marginTop:"8px"}},this.errors.platformUsername)),t("div",{className:"Form-group"},t("label",{className:"FormLabel"},r.translator.trans("wusong8899-tournament-widget.forum.participate_modal.win_loss_amount_label")),t("input",{className:this.errors.winLossAmount?"FormControl FormControl--error":"FormControl",type:"number",placeholder:r.translator.trans("wusong8899-tournament-widget.forum.participate_modal.win_loss_amount_placeholder"),value:this.winLossAmountText(),oninput:e=>{const a=e.target.value;if(this.winLossAmountText(a),a===""||a==="-")this.winLossAmount(0);else{const s=parseInt(a)||0;this.winLossAmount(s)}this.errors.winLossAmount&&(delete this.errors.winLossAmount,t.redraw())}}),this.errors.winLossAmount&&t("div",{className:"Alert Alert--error",style:{marginTop:"8px"}},this.errors.winLossAmount)),t("div",{className:"Form-group"},t(d,{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:!this.selectedPlatform||!this.platformUsername().trim(),onclick:this.onsubmit.bind(this)},r.translator.trans("wusong8899-tournament-widget.forum.participate_modal.submit")))))}onsubmit(e){if(e.preventDefault(),this.errors={},this.selectedPlatform||(this.errors.platform="需要选择平台"),this.platformUsername().trim()||(this.errors.platformUsername="需要输入平台用户名"),Object.keys(this.errors).length>0){t.redraw();return}this.loading=!0,r.request({method:"POST",url:r.forum.attribute("apiUrl")+"/tournament/participate",body:{data:{attributes:{platformId:this.selectedPlatform.id,platformUsername:this.platformUsername().trim(),winLossAmount:this.winLossAmount(),platformAccount:this.platformUsername().trim()}}}}).then(()=>{this.loading=!1,r.modal.close(),r.alerts.show({type:"success"},r.translator.trans("wusong8899-tournament-widget.forum.participate_modal.success")),this.attrs.onParticipate?.()},a=>{this.loading=!1,this.handleError(a),t.redraw()})}loadPlatforms(){r.request({method:"GET",url:r.forum.attribute("apiUrl")+"/tournament/platforms"}).then(e=>{const a=e?.data||[];this.platforms=a.map(s=>({id:s.id,name:s.attributes?.name,iconUrl:s.attributes?.iconUrl,iconClass:s.attributes?.iconClass,isActive:s.attributes?.isActive,displayOrder:s.attributes?.displayOrder})),this.loadingPlatforms=!1,t.redraw()}).catch(e=>{console.error("Failed to load platforms:",e),this.loadingPlatforms=!1,r.alerts.show({type:"error"},"加载平台信息失败"),t.redraw()})}onPlatformSelect(e){this.selectedPlatform=e,this.platformUsername(""),delete this.errors.platform,delete this.errors.platformId}handleError(e){if(this.errors={},e?.response?.errors)e.response.errors.forEach(s=>{if(s.source?.pointer){const l=s.source.pointer.replace("/data/attributes/","");this.errors[l]=s.detail||s.title}else r.alerts.show({type:"error"},s.detail||s.title||r.translator.trans("wusong8899-tournament-widget.forum.participate_modal.error"))});else if(e?.response?.data?.errors){const a=e.response.data.errors;Object.keys(a).forEach(s=>{this.errors[s]=a[s][0]})}else{const a=e?.response?.data?.message||e?.message||r.translator.trans("wusong8899-tournament-widget.forum.participate_modal.error");r.alerts.show({type:"error"},a)}}}const P={PRIMARY_GRADIENT:"linear-gradient(75.2deg, #2129a7 0.57%, #132cd1 72.59%)"};function D(i){return i?`url(${i}) center/cover no-repeat, ${P.PRIMARY_GRADIENT}`:P.PRIMARY_GRADIENT}class I extends c{view(e){const{title:a,prizePool:s,detailsUrl:l,backgroundImage:u,timeElapsed:n,userParticipated:f,userApplicationStatus:p,onParticipate:z}=e.attrs;return m("div",{className:"TournamentCard",style:{background:D(u)}},m("div",{className:"TournamentCard-header"},a&&m("div",{className:"TournamentCard-title"},a),m("a",{className:"TournamentCard-detailsLink",href:l,target:"_blank",rel:"noopener noreferrer"},r.translator.trans("wusong8899-tournament-widget.forum.tournament.details")),m("div",{className:"TournamentCard-prizePool"},m("label",null,r.translator.trans("wusong8899-tournament-widget.forum.tournament.prize_pool")),m("span",null,s))),m("div",{className:"TournamentCard-content"},m("div",{className:"TournamentCard-contentRow"},m("div",{className:"Timer"},m("label",null,r.translator.trans("wusong8899-tournament-widget.forum.tournament.started_at")),m("div",{className:"Timer-display"},m("div",{className:"Timer-boxes"},m("div",{className:"Timer-unit"},m("strong",null,n.days)),m("span",{className:"Timer-separator"},":"),m("div",{className:"Timer-unit"},m("strong",null,n.hours)),m("span",{className:"Timer-separator"},":"),m("div",{className:"Timer-unit"},m("strong",null,n.mins)),m("span",{className:"Timer-separator"},":"),m("div",{className:"Timer-unit"},m("strong",null,n.secs))),m("div",{className:"Timer-labels"},m("div",{className:"Timer-label"},"DAYS"),m("span",{className:"Timer-spacer"}),m("div",{className:"Timer-label"},"HRS"),m("span",{className:"Timer-spacer"}),m("div",{className:"Timer-label"},"MINS"),m("span",{className:"Timer-spacer"}),m("div",{className:"Timer-label"},"SECS")))),m("div",{className:"TournamentCard-actions"},!f&&r.session.user&&m(d,{className:"Button Button--primary TournamentCard-participateBtn",onclick:()=>{r.modal.show(L,{onParticipate:z})}},r.translator.trans("wusong8899-tournament-widget.forum.tournament.participate_now")),f&&p&&m("div",{className:`TournamentCard-status ${p.isApproved?"approved":"pending"}`},p.isApproved?m("[",null,m("i",{className:"fas fa-check-circle"}),r.translator.trans("wusong8899-tournament-widget.forum.tournament.approved")):m("[",null,m("i",{className:"fas fa-clock"}),r.translator.trans("wusong8899-tournament-widget.forum.tournament.pending_approval"))),!r.session.user&&m(d,{className:"Button Button--primary TournamentCard-participateBtn",onclick:()=>r.route("login")},r.translator.trans("wusong8899-tournament-widget.forum.tournament.login_to_participate"))))))}}class A extends w{constructor(){super(...arguments),this.loading=!0,this.tournamentData=null,this.error=null}oninit(e){super.oninit(e),this.loadTournamentData()}className(){return"TournamentRankingsModal Modal--large"}title(){return this.tournamentData?.headerTitle}async loadTournamentData(){try{this.loading=!0,t.redraw();const e=await r.request({method:"GET",url:`${r.forum.attribute("apiUrl")}/tournament`});if(e?.data?.attributes)this.tournamentData=e.data.attributes,this.error=null;else throw new Error("Invalid response format")}catch(e){console.error("Failed to load tournament data:",e),this.error="Failed to load tournament data"}finally{this.loading=!1,t.redraw()}}content(){try{return this.renderContent()}catch(e){return console.error("TournamentRankingsModal content error:",e),t("div",{className:"TournamentRankingsModal-error"},t("h3",null,"Error loading tournament rankings"),t("p",null,"Please try again or contact support."),t(d,{className:"Button Button--primary",onclick:()=>this.hide()},"关闭"))}}renderContent(){if(this.loading)return t(v,null);if(this.error||!this.tournamentData)return t("div",{className:"TournamentRankingsModal-error"},t("h3",null,r.translator.trans("core.forum.error.generic_message")),t("p",null,this.error||"Tournament data not available"),t(d,{className:"Button Button--primary",onclick:()=>this.hide()},"关闭"));const{tournamentData:e}=this;return t("div",{className:"TournamentRankingsModal-content"},t("div",{className:"TournamentRankingsModal-header"},t("div",{className:"TournamentRankingsModal-tournamentInfo"},t("h3",null,e.title),t("p",{className:"TournamentRankingsModal-prizePool"},r.translator.trans("wusong8899-tournament-widget.forum.tournament.prize_pool"),": ",e.prizePool))),t("div",{className:"TournamentRankingsModal-leaderboard"},this.renderFullLeaderboard()))}renderFullLeaderboard(){return!this.tournamentData||!this.tournamentData.participants.length?t("div",{className:"TournamentRankingsModal-empty"},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.no_participants")):t("div",{className:"Leaderboard Leaderboard--modal"},t("div",{className:"Leaderboard-header"},t("div",{className:"Leaderboard-headerRow"},t("div",{className:"Leaderboard-headerCell rank"},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.rank")),t("div",{className:"Leaderboard-headerCell user"},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.user")),t("div",{className:"Leaderboard-headerCell platform"},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.platform")),t("div",{className:"Leaderboard-headerCell score"},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.amount")))),t("div",{className:"Leaderboard-list"},this.tournamentData.participants.map(e=>t("div",{className:`Leaderboard-item rank-${e.rank}`,key:e.id,"data-rank":`#${e.rank}`,title:`${e.user.displayName} - ${e.title}`},t("div",{className:"Leaderboard-cell rank"},t("i",{className:this.getRankIcon(e.rank)}),t("span",{className:"rank-number"},e.rank)),t("div",{className:"Leaderboard-cell user"},t("div",{className:"user-info"},this.renderUserAvatar(e.user),t("div",{className:"user-details"},t("span",{className:"user-name"},e.user.displayName),t("span",{className:"user-title"},e.title)))),t("div",{className:"Leaderboard-cell platform"},t("div",{className:"platform-info"},this.renderPlatformIcon(e.platform),t("div",{className:"platform-details"},t("div",{className:"platform-name"},e.platform.name)))),t("div",{className:"Leaderboard-cell score"},t("span",{className:`score-amount ${e.amount<0?"negative":e.amount>0?"positive":"zero"}`},e.amount))))))}getRankIcon(e){return e===1?"fas fa-crown rank-gold":e===2?"fas fa-crown rank-silver":e===3?"fas fa-crown rank-bronze":"fas fa-medal"}renderUserAvatar(e){const a=r.store.getById("users",e.id);return a?N(a,{className:"user-avatar"}):e.avatarUrl?t("img",{className:"user-avatar",src:e.avatarUrl,alt:e.displayName}):t("div",{className:"user-avatar user-avatar--default"},t("i",{className:"fas fa-user"}))}renderPlatformIcon(e){return e.usesUrlIcon&&e.iconUrl?t("img",{className:"platform-icon image-icon",src:e.iconUrl,alt:e.name}):e.usesCssIcon&&e.iconClass?t("i",{className:`platform-icon css-icon ${e.iconClass}`}):t("i",{className:"platform-icon css-icon fas fa-gamepad"})}}class R extends c{constructor(){super(...arguments),this.containerRef=null}oncreate(e){super.oncreate(e),this.containerRef=e.dom,this.observeResize()}onremove(){this.resizeObserver&&this.resizeObserver.disconnect()}observeResize(){!this.containerRef||typeof ResizeObserver>"u"||(this.resizeObserver=new ResizeObserver(e=>{for(let a of e){const s=a.contentRect.width;s<640?(this.containerRef?.classList.add("compact-view"),this.containerRef?.classList.remove("wide-view")):s>1200?(this.containerRef?.classList.add("wide-view"),this.containerRef?.classList.remove("compact-view")):this.containerRef?.classList.remove("compact-view","wide-view")}}),this.resizeObserver.observe(this.containerRef))}view(e){const{participants:a}=e.attrs,s=r.forum.attribute("wusong8899_tournament.preview_limit"),l=s?parseInt(s):5,u=a.slice(0,l);return m("div",{className:"Leaderboard"},m("div",{className:"Leaderboard-header"},m("div",{className:"Leaderboard-headerRow"},m("div",{className:"Leaderboard-headerCell rank"},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.rank")),m("div",{className:"Leaderboard-headerCell user"},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.user")),m("div",{className:"Leaderboard-headerCell platform"},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.platform")),m("div",{className:"Leaderboard-headerCell score"},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.amount")))),m("div",{className:"Leaderboard-list"},u.length>0?u.map(n=>m("div",{className:`Leaderboard-item rank-${n.rank}`,key:n.id,"data-rank":`#${n.rank}`,title:`${n.user.displayName} - ${n.title}`},m("div",{className:"Leaderboard-cell rank"},m("i",{className:this.getRankIcon(n.rank)}),m("span",{className:"rank-number"},n.rank)),m("div",{className:"Leaderboard-cell user"},m("div",{className:"user-info"},this.renderUserAvatar(n.user),m("div",{className:"user-details"},m("span",{className:"user-name"},n.user.displayName),m("span",{className:"user-title"},n.title)))),m("div",{className:"Leaderboard-cell platform"},m("div",{className:"platform-info"},this.renderPlatformIcon(n.platform),m("div",{className:"platform-details"},m("div",{className:"platform-name"},n.platform.name)))),m("div",{className:"Leaderboard-cell score"},m("span",{className:`score-amount ${n.amount<0?"negative":n.amount>0?"positive":"zero"}`},n.amount)))):m("div",{className:"Leaderboard-empty"},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.no_participants"))),a.length>l&&m(d,{className:"Button Button--block Leaderboard-detailsBtn",onclick:n=>{n.preventDefault(),n.stopPropagation();try{r.modal.show(A)}catch(f){console.error("Modal show error:",f),r.alerts.show({type:"error"},"无法打开完整排行榜")}}},r.translator.trans("wusong8899-tournament-widget.forum.leaderboard.view_details")))}getRankIcon(e){return e===1?"fas fa-crown rank-gold":e===2?"fas fa-crown rank-silver":e===3?"fas fa-crown rank-bronze":"fas fa-medal"}renderUserAvatar(e){const a=r.store.getById("users",e.id);return a?N(a,{className:"user-avatar"}):e.avatarUrl?m("img",{className:"user-avatar",src:e.avatarUrl,alt:e.displayName}):m("div",{className:"user-avatar user-avatar--default"},m("i",{className:"fas fa-user"}))}renderPlatformIcon(e){return e.usesUrlIcon&&e.iconUrl?m("img",{className:"platform-icon image-icon",src:e.iconUrl,alt:e.name}):e.usesCssIcon&&e.iconClass?m("i",{className:`platform-icon css-icon ${e.iconClass}`}):m("i",{className:"platform-icon css-icon fas fa-gamepad"})}}function U(i){const e=Math.floor(i/1e3),a=Math.floor(e/60),s=Math.floor(a/60),l=Math.floor(s/24);return{days:String(l).padStart(2,"0"),hours:String(s%24).padStart(2,"0"),mins:String(a%60).padStart(2,"0"),secs:String(e%60).padStart(2,"0")}}class C extends c{constructor(){super(...arguments),this.loading=!0,this.tournamentData=null,this.timerInterval=null,this.animationFrame=null,this.timeElapsed={days:"00",hours:"00",mins:"00",secs:"00"},this.lastUpdateTime=0,this.isRedrawing=!1,this.loadingStartTime=0,this.loadingTimeout=null}oninit(e){super.oninit(e),this.loadData()}oncreate(e){super.oncreate(e)}onremove(e){super.onremove(e),this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.loadingTimeout&&(clearTimeout(this.loadingTimeout),this.loadingTimeout=null),this.tournamentData=null,this.isRedrawing=!1}view(){try{return this.loading?t("div",{className:"TournamentWidget"},t("div",{className:"TournamentWidget-loading"},t(v,null))):this.tournamentData?t("div",{className:"TournamentWidget"},t("div",{className:"TournamentHeader"},this.tournamentData.headerImage&&t("img",{className:"TournamentHeader-image",src:this.tournamentData.headerImage,alt:"Tournament"}),t("span",{className:"TournamentHeader-title"},this.tournamentData.headerTitle)),t(I,{title:this.tournamentData.title,prizePool:this.tournamentData.prizePool,detailsUrl:this.tournamentData.detailsUrl,backgroundImage:this.tournamentData.backgroundImage,timeElapsed:this.timeElapsed,userParticipated:this.tournamentData.userParticipated,userApplicationStatus:this.tournamentData.userApplicationStatus,onParticipate:()=>this.loadData()}),t(R,{participants:this.tournamentData.participants})):null}catch(e){return console.error("TournamentWidget view error:",e),t("div",{className:"TournamentWidget TournamentWidget--error"},t("div",{className:"TournamentWidget-error"},t("p",null,"Tournament widget encountered an error. Please refresh the page.")))}}startTimer(){if(!this.tournamentData?.startDate){console.warn("TournamentWidget: Cannot start timer - no tournament data or start date");return}const e=new Date(this.tournamentData.startDate);if(isNaN(e.getTime())){console.error("TournamentWidget: Invalid start date:",this.tournamentData.startDate);return}console.log("TournamentWidget: Starting timer with start date:",e),this.lastUpdateTime=Date.now();const a=()=>{if(this.isRedrawing||!this.tournamentData)return;const s=Date.now();if(s-this.lastUpdateTime>=1e3){const l=s-e.getTime();if(l>0){this.timeElapsed=U(l),this.lastUpdateTime=s,this.isRedrawing=!0;try{t.redraw()}catch(u){console.error("Tournament timer redraw error:",u)}finally{setTimeout(()=>{this.isRedrawing=!1},10)}}}this.tournamentData&&!this.isRedrawing&&(this.animationFrame=requestAnimationFrame(a))};this.animationFrame=requestAnimationFrame(a)}loadData(){if(this.loading){if(Date.now()-this.loadingStartTime<1e4)return console.log("TournamentWidget: Load already in progress, skipping"),Promise.resolve();console.warn("TournamentWidget: Loading timeout reached, forcing retry"),this.resetLoadingState()}return this.loading=!0,this.loadingStartTime=Date.now(),this.loadingTimeout=window.setTimeout(()=>{if(this.loading){console.error("TournamentWidget: Loading timeout exceeded, resetting state"),this.resetLoadingState();try{t.redraw()}catch(e){console.error("Failed to redraw after timeout reset:",e)}}},15e3),console.log("TournamentWidget: Starting data load request"),r.request({method:"GET",url:r.forum.attribute("apiUrl")+"/tournament"}).then(e=>{if(console.log("TournamentWidget: Received response:",e),!e||!e.data||!e.data.attributes)throw console.error("TournamentWidget: Invalid response structure:",e),new Error("Invalid tournament data response structure");const a=e.data.attributes;console.log("TournamentWidget: Processing tournament data with",a.participants?.length||0,"participants"),this.tournamentData={title:e.data.attributes.title||"",prizePool:e.data.attributes.prizePool||"0",startDate:e.data.attributes.startDate||new Date().toISOString(),detailsUrl:e.data.attributes.detailsUrl||"",backgroundImage:e.data.attributes.backgroundImage||"",headerTitle:e.data.attributes.headerTitle||"",headerImage:e.data.attributes.headerImage||"",userParticipated:e.data.attributes.userParticipated||!1,userApplicationStatus:e.data.attributes.userApplicationStatus||null,totalParticipants:e.data.attributes.totalParticipants||0,participants:e.data.attributes.participants||[]},this.loadingTimeout&&(clearTimeout(this.loadingTimeout),this.loadingTimeout=null),this.loading=!1,console.log("TournamentWidget: Successfully loaded tournament data"),!this.animationFrame&&this.tournamentData.startDate?(console.log("TournamentWidget: Starting timer for tournament"),this.startTimer()):this.animationFrame?console.log("TournamentWidget: Timer already running, skipping start"):console.warn("TournamentWidget: No start date provided, timer not started");try{t.redraw()}catch(s){console.error("Failed to redraw after loading data:",s)}}).catch(e=>{this.loadingTimeout&&(clearTimeout(this.loadingTimeout),this.loadingTimeout=null),this.loading=!1,e.response?console.error("TournamentWidget: Server error response:",e.response.status,e.response.data):e.request?console.error("TournamentWidget: Network error - no response received:",e.request):console.error("TournamentWidget: Request setup error:",e.message),console.warn("TournamentWidget: Setting fallback data to prevent complete failure"),this.tournamentData={title:"Tournament",prizePool:"0",startDate:new Date().toISOString(),detailsUrl:"",backgroundImage:"",headerTitle:"Tournament",headerImage:"",userParticipated:!1,userApplicationStatus:null,totalParticipants:0,participants:[]};try{t.redraw()}catch(a){console.error("Failed to redraw after error:",a)}})}resetLoadingState(){this.loading=!1,this.isRedrawing=!1,this.loadingStartTime=0,this.loadingTimeout&&(clearTimeout(this.loadingTimeout),this.loadingTimeout=null),console.log("TournamentWidget: Loading state reset")}}class F extends o{constructor(){super(...arguments),this.platformAccount=o.attribute("platformAccount"),this.platformUsername=o.attribute("platformUsername"),this.score=o.attribute("score"),this.initialScore=o.attribute("initialScore"),this.isApproved=o.attribute("isApproved"),this.approvedAt=o.attribute("approvedAt",e=>o.transformDate(e)??null),this.createdAt=o.attribute("createdAt",e=>o.transformDate(e)??null),this.updatedAt=o.attribute("updatedAt",e=>o.transformDate(e)??null),this.user=o.hasOne("user"),this.platform=o.hasOne("platform"),this.approvedBy=o.hasOne("approvedBy")}apiEndpoint(){return"/tournament/participants"}}class _ extends o{constructor(){super(...arguments),this.name=o.attribute("name"),this.iconUrl=o.attribute("iconUrl"),this.iconClass=o.attribute("iconClass"),this.isActive=o.attribute("isActive"),this.displayOrder=o.attribute("displayOrder"),this.usesUrlIcon=o.attribute("usesUrlIcon"),this.usesCssIcon=o.attribute("usesCssIcon")}apiEndpoint(){return"/tournament/platforms"}}new y.Store().add("participants",F).add("platforms",_),r.initializers.add("wusong8899-tournament-widget",()=>{T?k.extend(T.prototype,"content",function(i){const e=i.children;Array.isArray(e)&&e.push(t(C))}):console.warn("TagsPage not found - tournament widget will not be injected")})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/helpers/icon"],flarum.core.compat["common/helpers/avatar"],flarum.core.compat["tags/forum/components/TagsPage"],flarum.core.compat["common/extenders"],flarum.core.compat["common/Model"]);
//# sourceMappingURL=forum.js.map

module.exports={};