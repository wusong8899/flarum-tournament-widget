(function(a,h,s,d,f,u,w,c){"use strict";class p extends w{constructor(){super(...arguments),this.platformAccount="",this.loading=!1}className(){return"ParticipateModal Modal--small"}title(){return a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.title")}content(){return s("div",{className:"Modal-body"},s("div",{className:"Form"},s("div",{className:"Form-group"},s("label",{className:"FormLabel"},a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.platform_account_label")),s("input",{className:"FormControl",type:"text",placeholder:a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.platform_account_placeholder"),value:this.platformAccount,oninput:t=>{this.platformAccount=t.target.value}})),s("div",{className:"Form-group"},s(u,{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:!this.platformAccount.trim(),onclick:this.onsubmit.bind(this)},a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.submit")))))}onsubmit(t){t.preventDefault(),this.platformAccount.trim()&&(this.loading=!0,a.request({method:"POST",url:a.forum.attribute("apiUrl")+"/tournament/participate",body:{data:{attributes:{platformAccount:this.platformAccount.trim()}}}}).then(()=>{var e,r;this.hide(),a.alerts.show("success",a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.success")),(r=(e=this.attrs).onParticipate)==null||r.call(e)},e=>{var n,o,l;this.loading=!1;const r=((l=(o=(n=e==null?void 0:e.response)==null?void 0:n.errors)==null?void 0:o[0])==null?void 0:l.detail)||a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.error");a.alerts.show("error",r)}))}}class b extends d{view(t){const{title:e,prizePool:r,detailsUrl:n,backgroundImage:o,timeElapsed:l,userParticipated:g,onParticipate:D}=t.attrs;return m("div",{className:"TournamentCard",style:{backgroundImage:`url(${o})`}},m("a",{className:"TournamentCard-detailsLink",href:n,target:"_blank",rel:"noopener noreferrer"},a.translator.trans("wusong8899-tournament-widget.forum.tournament.details")),m("div",{className:"TournamentCard-content"},m("div",{className:"TournamentCard-title"},e),m("div",{className:"TournamentCard-prizePool"},m("label",null,a.translator.trans("wusong8899-tournament-widget.forum.tournament.prize_pool")),m("span",null,r)),m("div",{className:"Timer"},m("label",null,a.translator.trans("wusong8899-tournament-widget.forum.tournament.started_at")),m("div",{className:"Timer-display"},l.days,"å¤© ",l.hours,":",l.mins,":",l.secs)),!g&&a.session.user&&m(u,{className:"Button Button--primary TournamentCard-participateBtn",onclick:()=>{a.modal.show(p,{onParticipate:D})}},a.translator.trans("wusong8899-tournament-widget.forum.tournament.participate_now")),g&&m("div",{className:"TournamentCard-participated"},m("i",{className:"fas fa-check-circle"})," ",a.translator.trans("wusong8899-tournament-widget.forum.tournament.participated")),!a.session.user&&m(u,{className:"Button Button--primary TournamentCard-participateBtn",onclick:()=>a.route("login")},a.translator.trans("wusong8899-tournament-widget.forum.tournament.login_to_participate"))))}}class N extends d{constructor(){super(...arguments),this.showAll=!1}view(t){const{participants:e}=t.attrs,r=this.showAll?e:e.slice(0,5);return m("div",{className:"Leaderboard"},m("div",{className:"Leaderboard-header"},m("h3",null,a.translator.trans("wusong8899-tournament-widget.forum.leaderboard.title")),m("h4",null,a.translator.trans("wusong8899-tournament-widget.forum.leaderboard.points"))),m("ul",{className:"Leaderboard-list"},r.length>0?r.map((n,o)=>m("li",{className:`Leaderboard-item rank-${o+1}`,key:n.id},m("span",{className:"Leaderboard-rank"},m("i",{className:this.getRankIcon(o+1)})," ",o+1),m("span",{className:"Leaderboard-user"},m("div",{className:"username"},n.user.displayName),m("div",{className:"prize"},m("i",{className:"fas fa-gem"})," ",n.score)),m("span",{className:"Leaderboard-score"},n.score))):m("div",{className:"Leaderboard-empty"},a.translator.trans("wusong8899-tournament-widget.forum.leaderboard.no_participants"))),!this.showAll&&e.length>5&&m(u,{className:"Button Button--block Leaderboard-expandBtn",onclick:()=>{this.showAll=!0}},a.translator.trans("wusong8899-tournament-widget.forum.leaderboard.view_all",{count:e.length})),this.showAll&&e.length>5&&m(u,{className:"Button Button--block Leaderboard-collapseBtn",onclick:()=>{this.showAll=!1}},a.translator.trans("wusong8899-tournament-widget.forum.leaderboard.collapse")))}getRankIcon(t){return t===1?"fas fa-crown rank-gold":t===2?"fas fa-crown rank-silver":t===3?"fas fa-crown rank-bronze":"fas fa-medal"}}function v(i){const t=Math.floor(i/1e3),e=Math.floor(t/60),r=Math.floor(e/60),n=Math.floor(r/24);return{days:String(n).padStart(2,"0"),hours:String(r%24).padStart(2,"0"),mins:String(e%60).padStart(2,"0"),secs:String(t%60).padStart(2,"0")}}class T extends d{constructor(){super(...arguments),this.loading=!0,this.tournamentData=null,this.timerInterval=null,this.animationFrame=null,this.timeElapsed={days:"00",hours:"00",mins:"00",secs:"00"},this.lastUpdateTime=0}oninit(t){super.oninit(t),this.loadData()}oncreate(t){super.oncreate(t),this.startTimer()}onremove(t){super.onremove(t),this.timerInterval&&clearInterval(this.timerInterval),this.animationFrame&&cancelAnimationFrame(this.animationFrame)}view(){return this.loading?s("div",{className:"TournamentWidget"},s("div",{className:"TournamentWidget-loading"},s(f,null))):this.tournamentData?s("div",{className:"TournamentWidget"},s(b,{title:this.tournamentData.title,prizePool:this.tournamentData.prizePool,detailsUrl:this.tournamentData.detailsUrl,backgroundImage:this.tournamentData.backgroundImage,timeElapsed:this.timeElapsed,userParticipated:this.tournamentData.userParticipated,onParticipate:()=>this.loadData()}),s(N,{participants:this.tournamentData.participants})):null}startTimer(){var r;if(!((r=this.tournamentData)!=null&&r.startDate))return;const t=new Date(this.tournamentData.startDate);this.lastUpdateTime=Date.now();const e=()=>{const n=Date.now();if(n-this.lastUpdateTime>=1e3){const o=n-t.getTime();o>0&&(this.timeElapsed=v(o),this.lastUpdateTime=n,s.redraw())}this.animationFrame=requestAnimationFrame(e)};this.animationFrame=requestAnimationFrame(e)}loadData(){return this.loading=!0,a.request({method:"GET",url:a.forum.attribute("apiUrl")+"/tournament"}).then(t=>{this.tournamentData={title:t.data.attributes.title,prizePool:t.data.attributes.prizePool,startDate:t.data.attributes.startDate,detailsUrl:t.data.attributes.detailsUrl,backgroundImage:t.data.attributes.backgroundImage,userParticipated:t.data.attributes.userParticipated,totalParticipants:t.data.attributes.totalParticipants,participants:t.data.attributes.participants||[]},this.loading=!1,this.timerInterval||this.startTimer(),s.redraw()}).catch(t=>{this.loading=!1,console.error("Failed to load tournament data:",t),s.redraw()})}}a.initializers.add("wusong8899-tournament-widget",()=>{c?h.extend(c.prototype,"content",function(i){const t=i.children;if(!Array.isArray(t))return;const e=t.findIndex(r=>{var n,o;return(o=(n=r==null?void 0:r.attrs)==null?void 0:n.className)==null?void 0:o.includes("user-submission-widget-dynamic")});e>-1&&t.splice(e+1,0,s(T))}):console.warn("TagsPage not found - tournament widget will not be injected")})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/Modal"],flarum.core.compat["tags/forum/components/TagsPage"]);
//# sourceMappingURL=forum.js.map

module.exports={};