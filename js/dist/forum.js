(function(a,g,e,d,f,u,p,c){"use strict";class w extends p{constructor(){super(...arguments),this.platformAccount="",this.loading=!1}className(){return"ParticipateModal Modal--small"}title(){return a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.title")}content(){return e("div",{className:"Modal-body"},e("div",{className:"Form"},e("div",{className:"Form-group"},e("label",{className:"FormLabel"},a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.platform_account_label")),e("input",{className:"FormControl",type:"text",placeholder:a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.platform_account_placeholder"),value:this.platformAccount,oninput:t=>{this.platformAccount=t.target.value}})),e("div",{className:"Form-group"},e(u,{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:!this.platformAccount.trim(),onclick:this.onsubmit.bind(this)},a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.submit")))))}onsubmit(t){t.preventDefault(),this.platformAccount.trim()&&(this.loading=!0,a.request({method:"POST",url:a.forum.attribute("apiUrl")+"/tournament/participate",body:{data:{attributes:{platformAccount:this.platformAccount.trim()}}}}).then(()=>{var r,n;this.hide(),a.alerts.show("success",a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.success")),(n=(r=this.attrs).onParticipate)==null||n.call(r)},r=>{var o,s,l;this.loading=!1;const n=((l=(s=(o=r==null?void 0:r.response)==null?void 0:o.errors)==null?void 0:s[0])==null?void 0:l.detail)||a.translator.trans("wusong8899-tournament-widget.forum.participate_modal.error");a.alerts.show("error",n)}))}}class b extends d{view(t){const{title:r,prizePool:n,detailsUrl:o,backgroundImage:s,timeElapsed:l,userParticipated:h,onParticipate:D}=t.attrs;return m("div",{className:"TournamentCard",style:{backgroundImage:`url(${s})`}},m("a",{className:"TournamentCard-detailsLink",href:o,target:"_blank",rel:"noopener noreferrer"},a.translator.trans("wusong8899-tournament-widget.forum.tournament.details")),m("div",{className:"TournamentCard-content"},m("div",{className:"TournamentCard-title"},r),m("div",{className:"TournamentCard-prizePool"},m("label",null,a.translator.trans("wusong8899-tournament-widget.forum.tournament.prize_pool")),m("span",null,n)),m("div",{className:"Timer"},m("label",null,a.translator.trans("wusong8899-tournament-widget.forum.tournament.started_at")),m("div",{className:"Timer-display"},l.days,"å¤© ",l.hours,":",l.mins,":",l.secs)),!h&&a.session.user&&m(u,{className:"Button Button--primary TournamentCard-participateBtn",onclick:()=>{a.modal.show(w,{onParticipate:D})}},a.translator.trans("wusong8899-tournament-widget.forum.tournament.participate_now")),h&&m("div",{className:"TournamentCard-participated"},m("i",{className:"fas fa-check-circle"})," ",a.translator.trans("wusong8899-tournament-widget.forum.tournament.participated")),!a.session.user&&m(u,{className:"Button Button--primary TournamentCard-participateBtn",onclick:()=>a.route("login")},a.translator.trans("wusong8899-tournament-widget.forum.tournament.login_to_participate"))))}}class N extends d{constructor(){super(...arguments),this.showAll=!1}view(t){const{participants:r}=t.attrs,n=this.showAll?r:r.slice(0,5);return m("div",{className:"Leaderboard"},m("div",{className:"Leaderboard-header"},m("h3",null,a.translator.trans("wusong8899-tournament-widget.forum.leaderboard.title")),m("h4",null,a.translator.trans("wusong8899-tournament-widget.forum.leaderboard.points"))),m("ul",{className:"Leaderboard-list"},n.length>0?n.map((o,s)=>m("li",{className:`Leaderboard-item rank-${s+1}`,key:o.id},m("span",{className:"Leaderboard-rank"},m("i",{className:this.getRankIcon(s+1)})," ",s+1),m("span",{className:"Leaderboard-user"},m("div",{className:"username"},o.user.displayName),m("div",{className:"prize"},m("i",{className:"fas fa-gem"})," ",o.score)),m("span",{className:"Leaderboard-score"},o.score))):m("div",{className:"Leaderboard-empty"},a.translator.trans("wusong8899-tournament-widget.forum.leaderboard.no_participants"))),!this.showAll&&r.length>5&&m(u,{className:"Button Button--block Leaderboard-expandBtn",onclick:()=>{this.showAll=!0}},a.translator.trans("wusong8899-tournament-widget.forum.leaderboard.view_all",{count:r.length})),this.showAll&&r.length>5&&m(u,{className:"Button Button--block Leaderboard-collapseBtn",onclick:()=>{this.showAll=!1}},a.translator.trans("wusong8899-tournament-widget.forum.leaderboard.collapse")))}getRankIcon(t){return t===1?"fas fa-crown rank-gold":t===2?"fas fa-crown rank-silver":t===3?"fas fa-crown rank-bronze":"fas fa-medal"}}function v(i){const t=Math.floor(i/1e3),r=Math.floor(t/60),n=Math.floor(r/60),o=Math.floor(n/24);return{days:String(o).padStart(2,"0"),hours:String(n%24).padStart(2,"0"),mins:String(r%60).padStart(2,"0"),secs:String(t%60).padStart(2,"0")}}class T extends d{constructor(){super(...arguments),this.loading=!0,this.tournamentData=null,this.timerInterval=null,this.animationFrame=null,this.timeElapsed={days:"00",hours:"00",mins:"00",secs:"00"},this.lastUpdateTime=0}oninit(t){super.oninit(t),this.loadData()}oncreate(t){super.oncreate(t),this.startTimer()}onremove(t){super.onremove(t),this.timerInterval&&clearInterval(this.timerInterval),this.animationFrame&&cancelAnimationFrame(this.animationFrame)}view(){return this.loading?e("div",{className:"TournamentWidget"},e("div",{className:"TournamentWidget-loading"},e(f,null))):this.tournamentData?e("div",{className:"TournamentWidget"},e(b,{title:this.tournamentData.title,prizePool:this.tournamentData.prizePool,detailsUrl:this.tournamentData.detailsUrl,backgroundImage:this.tournamentData.backgroundImage,timeElapsed:this.timeElapsed,userParticipated:this.tournamentData.userParticipated,onParticipate:()=>this.loadData()}),e(N,{participants:this.tournamentData.participants})):null}startTimer(){var n;if(!((n=this.tournamentData)!=null&&n.startDate))return;const t=new Date(this.tournamentData.startDate);this.lastUpdateTime=Date.now();const r=()=>{const o=Date.now();if(o-this.lastUpdateTime>=1e3){const s=o-t.getTime();s>0&&(this.timeElapsed=v(s),this.lastUpdateTime=o,e.redraw())}this.animationFrame=requestAnimationFrame(r)};this.animationFrame=requestAnimationFrame(r)}loadData(){return this.loading=!0,a.request({method:"GET",url:a.forum.attribute("apiUrl")+"/tournament"}).then(t=>{this.tournamentData={title:t.data.attributes.title,prizePool:t.data.attributes.prizePool,startDate:t.data.attributes.startDate,detailsUrl:t.data.attributes.detailsUrl,backgroundImage:t.data.attributes.backgroundImage,userParticipated:t.data.attributes.userParticipated,totalParticipants:t.data.attributes.totalParticipants,participants:t.data.attributes.participants||[]},this.loading=!1,this.timerInterval||this.startTimer(),e.redraw()}).catch(t=>{this.loading=!1,console.error("Failed to load tournament data:",t),e.redraw()})}}a.initializers.add("wusong8899-tournament-widget",()=>{c?g.extend(c.prototype,"content",function(i){const t=i.children;Array.isArray(t)&&t.push(e(T))}):console.warn("TagsPage not found - tournament widget will not be injected")})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/Modal"],flarum.core.compat["tags/forum/components/TagsPage"]);
//# sourceMappingURL=forum.js.map

module.exports={};