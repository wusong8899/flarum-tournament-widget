(function(t,h,r,u,f,d,w,c){"use strict";class b extends w{constructor(){super(...arguments),this.platformAccount="",this.loading=!1}className(){return"ParticipateModal Modal--small"}title(){return t.translator.trans("wusong8899-tournament-widget.forum.participate_modal.title")}content(){return r("div",{className:"Modal-body"},r("div",{className:"Form"},r("div",{className:"Form-group"},r("label",{className:"FormLabel"},t.translator.trans("wusong8899-tournament-widget.forum.participate_modal.platform_account_label")),r("input",{className:"FormControl",type:"text",placeholder:t.translator.trans("wusong8899-tournament-widget.forum.participate_modal.platform_account_placeholder"),value:this.platformAccount,oninput:a=>{this.platformAccount=a.target.value}})),r("div",{className:"Form-group"},r(d,{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:!this.platformAccount.trim(),onclick:this.onsubmit.bind(this)},t.translator.trans("wusong8899-tournament-widget.forum.participate_modal.submit")))))}onsubmit(a){a.preventDefault(),this.platformAccount.trim()&&(this.loading=!0,t.request({method:"POST",url:t.forum.attribute("apiUrl")+"/tournament/participate",body:{data:{attributes:{platformAccount:this.platformAccount.trim()}}}}).then(()=>{var s,n;this.hide(),t.alerts.show("success",t.translator.trans("wusong8899-tournament-widget.forum.participate_modal.success")),(n=(s=this.attrs).onParticipate)==null||n.call(s)},s=>{var e,i,l;this.loading=!1;const n=((l=(i=(e=s==null?void 0:s.response)==null?void 0:e.errors)==null?void 0:i[0])==null?void 0:l.detail)||t.translator.trans("wusong8899-tournament-widget.forum.participate_modal.error");t.alerts.show("error",n)}))}}class N extends u{view(a){const{title:s,prizePool:n,detailsUrl:e,backgroundImage:i,timeElapsed:l,userParticipated:g,onParticipate:k}=a.attrs;return m("div",{className:"TournamentCard",style:{backgroundImage:`url(${i})`}},m("a",{className:"TournamentCard-detailsLink",href:e,target:"_blank",rel:"noopener noreferrer"},t.translator.trans("wusong8899-tournament-widget.forum.tournament.details")),m("div",{className:"TournamentCard-content"},m("div",{className:"TournamentCard-title"},s),m("div",{className:"TournamentCard-prizePool"},m("label",null,t.translator.trans("wusong8899-tournament-widget.forum.tournament.prize_pool")),m("span",null,n)),m("div",{className:"Timer"},m("label",null,t.translator.trans("wusong8899-tournament-widget.forum.tournament.started_at")),m("div",{className:"Timer-display"},l.days,"天 ",l.hours,":",l.mins,":",l.secs)),!g&&t.session.user&&m(d,{className:"Button Button--primary TournamentCard-participateBtn",onclick:()=>{t.modal.show(b,{onParticipate:k})}},t.translator.trans("wusong8899-tournament-widget.forum.tournament.participate_now")),g&&m("div",{className:"TournamentCard-participated"},m("i",{className:"fas fa-check-circle"})," ",t.translator.trans("wusong8899-tournament-widget.forum.tournament.participated")),!t.session.user&&m(d,{className:"Button Button--primary TournamentCard-participateBtn",onclick:()=>t.route("login")},t.translator.trans("wusong8899-tournament-widget.forum.tournament.login_to_participate"))))}}class v extends u{constructor(){super(...arguments),this.showAll=!1}view(a){const{participants:s}=a.attrs,n=this.showAll?s:s.slice(0,5);return m("div",{className:"Leaderboard"},m("div",{className:"Leaderboard-header"},m("div",{className:"Leaderboard-headerRow"},m("div",{className:"Leaderboard-headerCell rank"},t.translator.trans("wusong8899-tournament-widget.forum.leaderboard.rank")),m("div",{className:"Leaderboard-headerCell title"},t.translator.trans("wusong8899-tournament-widget.forum.leaderboard.rank_title")),m("div",{className:"Leaderboard-headerCell user"},t.translator.trans("wusong8899-tournament-widget.forum.leaderboard.user")),m("div",{className:"Leaderboard-headerCell platform"},t.translator.trans("wusong8899-tournament-widget.forum.leaderboard.platform")),m("div",{className:"Leaderboard-headerCell score"},t.translator.trans("wusong8899-tournament-widget.forum.leaderboard.score")))),m("div",{className:"Leaderboard-list"},n.length>0?n.map(e=>m("div",{className:`Leaderboard-item rank-${e.rank}`,key:e.id},m("div",{className:"Leaderboard-cell rank"},m("i",{className:this.getRankIcon(e.rank)}),m("span",{className:"rank-number"},e.rank)),m("div",{className:"Leaderboard-cell title"},m("span",{className:"title-text"},e.title)),m("div",{className:"Leaderboard-cell user"},m("div",{className:"user-info"},e.user.avatarUrl&&m("img",{className:"user-avatar",src:e.user.avatarUrl,alt:e.user.displayName}),m("span",{className:"user-name"},e.user.displayName))),m("div",{className:"Leaderboard-cell platform"},m("div",{className:"platform-info"},this.renderPlatformIcon(e.platform),m("div",{className:"platform-details"},m("div",{className:"platform-name"},e.platform.name),m("div",{className:"platform-username"},e.platform.username)))),m("div",{className:"Leaderboard-cell score"},m("span",{className:"score-amount"},e.score)))):m("div",{className:"Leaderboard-empty"},t.translator.trans("wusong8899-tournament-widget.forum.leaderboard.no_participants"))),!this.showAll&&s.length>5&&m(d,{className:"Button Button--block Leaderboard-expandBtn",onclick:()=>{this.showAll=!0}},t.translator.trans("wusong8899-tournament-widget.forum.leaderboard.view_all",{count:s.length})),this.showAll&&s.length>5&&m(d,{className:"Button Button--block Leaderboard-collapseBtn",onclick:()=>{this.showAll=!1}},t.translator.trans("wusong8899-tournament-widget.forum.leaderboard.collapse")))}getRankIcon(a){return a===1?"fas fa-crown rank-gold":a===2?"fas fa-crown rank-silver":a===3?"fas fa-crown rank-bronze":"fas fa-medal"}renderPlatformIcon(a){return a.usesUrlIcon&&a.iconUrl?m("img",{className:"platform-icon image-icon",src:a.iconUrl,alt:a.name}):a.usesCssIcon&&a.iconClass?m("i",{className:`platform-icon css-icon ${a.iconClass}`}):m("i",{className:"platform-icon css-icon fas fa-gamepad"})}}function p(o){const a=Math.floor(o/1e3),s=Math.floor(a/60),n=Math.floor(s/60),e=Math.floor(n/24);return{days:String(e).padStart(2,"0"),hours:String(n%24).padStart(2,"0"),mins:String(s%60).padStart(2,"0"),secs:String(a%60).padStart(2,"0")}}class T extends u{constructor(){super(...arguments),this.loading=!0,this.tournamentData=null,this.timerInterval=null,this.animationFrame=null,this.timeElapsed={days:"00",hours:"00",mins:"00",secs:"00"},this.lastUpdateTime=0}oninit(a){super.oninit(a),this.loadData()}oncreate(a){super.oncreate(a),this.startTimer()}onremove(a){super.onremove(a),this.timerInterval&&clearInterval(this.timerInterval),this.animationFrame&&cancelAnimationFrame(this.animationFrame)}view(){return this.loading?r("div",{className:"TournamentWidget"},r("div",{className:"TournamentWidget-loading"},r(f,null))):this.tournamentData?r("div",{className:"TournamentWidget"},r("div",{className:"TournamentHeader"},r("img",{className:"TournamentHeader-image",src:"https://i.mji.rip/2025/08/23/678aa40f68db12909bb4a4871d603876.webp",alt:"Tournament"}),r("span",{className:"TournamentHeader-title"},"老哥榜")),r(N,{title:this.tournamentData.title,prizePool:this.tournamentData.prizePool,detailsUrl:this.tournamentData.detailsUrl,backgroundImage:this.tournamentData.backgroundImage,timeElapsed:this.timeElapsed,userParticipated:this.tournamentData.userParticipated,onParticipate:()=>this.loadData()}),r(v,{participants:this.tournamentData.participants})):null}startTimer(){var n;if(!((n=this.tournamentData)!=null&&n.startDate))return;const a=new Date(this.tournamentData.startDate);this.lastUpdateTime=Date.now();const s=()=>{const e=Date.now();if(e-this.lastUpdateTime>=1e3){const i=e-a.getTime();i>0&&(this.timeElapsed=p(i),this.lastUpdateTime=e,r.redraw())}this.animationFrame=requestAnimationFrame(s)};this.animationFrame=requestAnimationFrame(s)}loadData(){return this.loading=!0,t.request({method:"GET",url:t.forum.attribute("apiUrl")+"/tournament"}).then(a=>{this.tournamentData={title:a.data.attributes.title,prizePool:a.data.attributes.prizePool,startDate:a.data.attributes.startDate,detailsUrl:a.data.attributes.detailsUrl,backgroundImage:a.data.attributes.backgroundImage,userParticipated:a.data.attributes.userParticipated,totalParticipants:a.data.attributes.totalParticipants,participants:a.data.attributes.participants||[]},this.loading=!1,this.timerInterval||this.startTimer(),r.redraw()}).catch(a=>{this.loading=!1,console.error("Failed to load tournament data:",a),r.redraw()})}}t.initializers.add("wusong8899-tournament-widget",()=>{c?h.extend(c.prototype,"content",function(o){const a=o.children;Array.isArray(a)&&a.push(r(T))}):console.warn("TagsPage not found - tournament widget will not be injected")})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],m,flarum.core.compat["common/Component"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/Modal"],flarum.core.compat["tags/forum/components/TagsPage"]);
//# sourceMappingURL=forum.js.map

module.exports={};